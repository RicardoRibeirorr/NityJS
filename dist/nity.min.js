var Nity=(()=>{var et=Object.defineProperty;var Wt=Object.getOwnPropertyDescriptor;var Ht=Object.getOwnPropertyNames;var Zt=Object.prototype.hasOwnProperty;var h=(o,t)=>et(o,"name",{value:t,configurable:!0});var E=(o,t)=>()=>(o&&(t=o(o=0)),t);var it=(o,t)=>{for(var e in t)et(o,e,{get:t[e],enumerable:!0})},Vt=(o,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ht(t))!Zt.call(o,s)&&s!==e&&et(o,s,{get:()=>t[s],enumerable:!(i=Wt(t,s))||i.enumerable});return o};var _t=o=>Vt(et({},"__esModule",{value:!0}),o);var K,pt=E(()=>{K=class o{static{h(this,"AudioClip")}constructor(t,e){this.name=t,this.url=e,this.audioBuffer=null,this.length=0,this.channels=0,this.frequency=0,this.isLoaded=!1,this.isLoading=!1,this.loadError=null,this.audioContext=o.getAudioContext()}static getAudioContext(){if(!o._audioContext){let t=window.AudioContext||window.webkitAudioContext;if(!t)throw new Error("Web Audio API not supported in this browser");o._audioContext=new t,o._audioContext.state==="suspended"&&document.addEventListener("click",()=>{o._audioContext.state==="suspended"&&o._audioContext.resume()},{once:!0})}return o._audioContext}async load(){if(this.isLoaded)return!0;if(this.isLoading)return new Promise(t=>{let e=h(()=>{this.isLoading?setTimeout(e,10):t(this.isLoaded)},"checkLoaded");e()});this.isLoading=!0,this.loadError=null;try{let t=await fetch(this.url);if(!t.ok)throw new Error(`Failed to fetch audio: ${t.status} ${t.statusText}`);let e=await t.arrayBuffer();return this.audioBuffer=await this.audioContext.decodeAudioData(e),this.length=this.audioBuffer.length/this.audioBuffer.sampleRate,this.channels=this.audioBuffer.numberOfChannels,this.frequency=this.audioBuffer.sampleRate,this.isLoaded=!0,this.isLoading=!1,console.log(`\u2705 Audio clip loaded: ${this.name} (${this.length.toFixed(2)}s, ${this.channels}ch, ${this.frequency}Hz)`),!0}catch(t){return this.loadError=t.message,this.isLoading=!1,this.isLoaded=!1,console.error(`\u274C Failed to load audio clip '${this.name}':`,t),!1}}createSourceNode(){if(!this.isLoaded||!this.audioBuffer)return console.warn(`Cannot create source node: Audio clip '${this.name}' not loaded`),null;let t=this.audioContext.createBufferSource();return t.buffer=this.audioBuffer,t}get isReady(){return this.isLoaded&&this.audioBuffer!==null}get state(){return this.loadError?"error":this.isLoading?"loading":this.isLoaded?"loaded":"unloaded"}static async preloadAll(t){let e=t.map(i=>i.load());return Promise.all(e)}};K._audioContext=null});var mt={};it(mt,{AudioAsset:()=>st});var st,ot=E(()=>{nt();pt();st=class o extends K{static{h(this,"AudioAsset")}constructor(t,e,i={}){super(t,e),this.audioPath=e,this.volume=i.volume!==void 0?i.volume:1,this.loop=i.loop||!1,this.format=i.format||this.#i(e),this.#t(),this.load()}#t(){L._addAudio(this.name,this)}#i(t){return t.split(".").pop().toLowerCase()}clone(t={}){return new o(this.name+"_copy",this.audioPath,{volume:t.volume!==void 0?t.volume:this.volume,loop:t.loop!==void 0?t.loop:this.loop,format:t.format||this.format,...t})}getInfo(){return{name:this.name,path:this.audioPath,format:this.format,isLoaded:this.isLoaded,duration:this.length,sampleRate:this.frequency,channels:this.channels,volume:this.volume,loop:this.loop}}dispose(){this.audioBuffer=null,this.audioContext=null,this.isLoaded=!1,L._removeAudio(this.name),console.log(`AudioAsset "${this.name}" disposed`)}static async create(t,e,i={}){let s=new o(t,e,i);return await s.load(),s}static async preloadMultiple(t){let e=t.map(i=>o.create(i.name,i.path,i.config||{}));try{let i=await Promise.all(e);return console.log(`Preloaded ${i.length} audio assets`),i}catch(i){throw console.error("Failed to preload some audio assets:",i),i}}}});var L,nt=E(()=>{L=class{static{h(this,"AudioRegistry")}static audioAssets=new Map;static _addAudio(t,e){this.audioAssets.set(t,e),console.log(`AudioRegistry: Registered audio "${t}"`)}static _removeAudio(t){this.audioAssets.delete(t)&&console.log(`AudioRegistry: Removed audio "${t}"`)}static getAudio(t){let e=this.audioAssets.get(t);return e||(console.warn(`AudioRegistry: Audio "${t}" not found. Available audio:`,[...this.audioAssets.keys()]),null)}static getAudioClip(t){let e=this.getAudio(t);return e?e.toAudioClip():null}static hasAudio(t){return this.audioAssets.has(t)}static getAllAudioNames(){return[...this.audioAssets.keys()]}static getAllAudio(){return[...this.audioAssets.values()]}static getAllAudioInfo(){return this.getAllAudio().map(t=>t.getInfo())}static getLoadingStatus(){let t=this.getAllAudio(),e=t.filter(s=>s.isReady()),i=t.filter(s=>!s.isReady());return{total:t.length,loaded:e.length,loading:i.length,progress:t.length>0?e.length/t.length:1,loadedAssets:e.map(s=>s.name),loadingAssets:i.map(s=>s.name)}}static async preloadAll(){let e=this.getAllAudio().map(i=>i.load());try{await Promise.all(e),console.log("AudioRegistry: All audio assets loaded successfully")}catch(i){throw console.error("AudioRegistry: Some audio assets failed to load:",i),i}}static async waitForAllToLoad(){return this.preloadAll()}static async loadAll(){return this.preloadAll()}static async preloadAudio(t){let{AudioAsset:e}=await Promise.resolve().then(()=>(ot(),mt));return e.preloadMultiple(t)}static clear(){this.getAllAudio().forEach(e=>e.dispose()),this.audioAssets.clear(),console.log("AudioRegistry: Cleared all audio assets")}static removeAudio(t){let e=this.getAudio(t);return e?(e.dispose(),!0):!1}static getMemoryUsage(){let t=this.getAllAudio(),e=0,i=0,s=0;return t.forEach(n=>{if(n.isReady()){let r=n.getDuration(),a=n.getSampleRate(),l=n.getChannelCount();e+=r,i+=l,s+=a*l*r*4/(1024*1024)}}),{totalAssets:t.length,loadedAssets:t.filter(n=>n.isReady()).length,totalDurationSeconds:Math.round(e),averageChannels:t.length>0?i/t.length:0,estimatedMemoryMB:Math.round(s*100)/100}}static async loadBatch(t,e=null){let i=[],s=0;for(let n of t)try{let{AudioAsset:r}=await Promise.resolve().then(()=>(ot(),mt)),a=await r.create(n.name,n.path,n.config||{});i.push(a),s++,e&&e(s,t.length)}catch(r){console.error(`Failed to load audio "${n.name}":`,r),i.push(null)}return console.log(`AudioRegistry: Batch loaded ${i.filter(n=>n).length}/${t.length} audio assets`),i}static debug(){console.group("AudioRegistry Debug Information"),console.log("Registered Audio Assets:",this.getAllAudioNames()),console.log("Loading Status:",this.getLoadingStatus()),console.log("Memory Usage:",this.getMemoryUsage()),console.log("Detailed Info:",this.getAllAudioInfo()),console.groupEnd()}}});var Et={};it(Et,{Keyboard:()=>rt});var rt,gt=E(()=>{rt=class o{static{h(this,"Keyboard")}static Space=["Space"," "];static Enter=["Enter"];static Escape=["Escape"];static Tab=["Tab"];static Backspace=["Backspace"];static Delete=["Delete"];static Insert=["Insert"];static Home=["Home"];static End=["End"];static PageUp=["PageUp"];static PageDown=["PageDown"];static ArrowUp=["ArrowUp"];static ArrowDown=["ArrowDown"];static ArrowLeft=["ArrowLeft"];static ArrowRight=["ArrowRight"];static Digit0=["Digit0","0"];static Digit1=["Digit1","1"];static Digit2=["Digit2","2"];static Digit3=["Digit3","3"];static Digit4=["Digit4","4"];static Digit5=["Digit5","5"];static Digit6=["Digit6","6"];static Digit7=["Digit7","7"];static Digit8=["Digit8","8"];static Digit9=["Digit9","9"];static KeyA=["KeyA","a","A"];static KeyB=["KeyB","b","B"];static KeyC=["KeyC","c","C"];static KeyD=["KeyD","d","D"];static KeyE=["KeyE","e","E"];static KeyF=["KeyF","f","F"];static KeyG=["KeyG","g","G"];static KeyH=["KeyH","h","H"];static KeyI=["KeyI","i","I"];static KeyJ=["KeyJ","j","J"];static KeyK=["KeyK","k","K"];static KeyL=["KeyL","l","L"];static KeyM=["KeyM","m","M"];static KeyN=["KeyN","n","N"];static KeyO=["KeyO","o","O"];static KeyP=["KeyP","p","P"];static KeyQ=["KeyQ","q","Q"];static KeyR=["KeyR","r","R"];static KeyS=["KeyS","s","S"];static KeyT=["KeyT","t","T"];static KeyU=["KeyU","u","U"];static KeyV=["KeyV","v","V"];static KeyW=["KeyW","w","W"];static KeyX=["KeyX","x","X"];static KeyY=["KeyY","y","Y"];static KeyZ=["KeyZ","z","Z"];static F1=["F1"];static F2=["F2"];static F3=["F3"];static F4=["F4"];static F5=["F5"];static F6=["F6"];static F7=["F7"];static F8=["F8"];static F9=["F9"];static F10=["F10"];static F11=["F11"];static F12=["F12"];static ShiftLeft=["ShiftLeft","Shift"];static ShiftRight=["ShiftRight","Shift"];static ControlLeft=["ControlLeft","Control"];static ControlRight=["ControlRight","Control"];static AltLeft=["AltLeft","Alt"];static AltRight=["AltRight","Alt"];static MetaLeft=["MetaLeft","Meta"];static MetaRight=["MetaRight","Meta"];static Minus=["Minus","-"];static Equal=["Equal","="];static BracketLeft=["BracketLeft","["];static BracketRight=["BracketRight","]"];static Backslash=["Backslash","\\"];static Semicolon=["Semicolon",";"];static Quote=["Quote","'"];static Comma=["Comma",","];static Period=["Period","."];static Slash=["Slash","/"];static Numpad0=["Numpad0"];static Numpad1=["Numpad1"];static Numpad2=["Numpad2"];static Numpad3=["Numpad3"];static Numpad4=["Numpad4"];static Numpad5=["Numpad5"];static Numpad6=["Numpad6"];static Numpad7=["Numpad7"];static Numpad8=["Numpad8"];static Numpad9=["Numpad9"];static NumpadAdd=["NumpadAdd","+"];static NumpadSubtract=["NumpadSubtract","-"];static NumpadMultiply=["NumpadMultiply","*"];static NumpadDivide=["NumpadDivide","/"];static NumpadDecimal=["NumpadDecimal","."];static NumpadEnter=["NumpadEnter"];static _keyMapping=null;static initialize(){if(!o._keyMapping){o._keyMapping=new Map;for(let[t,e]of Object.entries(o))if(Array.isArray(e))for(let i of e)o._keyMapping.set(i.toLowerCase(),t)}}static getLogicalKey(t){return o._keyMapping||o.initialize(),o._keyMapping.get(t.toLowerCase())||t}static matches(t,e){let i=o[t];return!i||!Array.isArray(i)?!1:i.some(s=>s.toLowerCase()===e.toLowerCase())}static getPhysicalKeys(t){return o[t]||[]}static getAllLogicalKeys(){return Object.keys(o).filter(t=>Array.isArray(o[t])&&!t.startsWith("_"))}}});var R,at=E(()=>{R=class{static{h(this,"Tile")}constructor(t,e,i={}){this.name=t,this.spriteName=e,this.width=i.width||null,this.height=i.height||null,this.opacity=i.opacity!==void 0?i.opacity:1,this.color=i.color||"#FFFFFF",this.flipX=i.flipX||!1,this.flipY=i.flipY||!1,this.collider=i.collider?{width:i.collider.width||null,height:i.collider.height||null,radius:i.collider.radius||null,trigger:i.collider.trigger||!1,type:i.collider.type||"box"}:null}hasCollision(){return this.collider!==null}isTrigger(){return this.collider&&this.collider.trigger}isSolid(){return this.collider&&!this.collider.trigger}getColliderType(){return this.collider?this.collider.type:null}clone(t={}){let e={width:this.width,height:this.height,opacity:this.opacity,color:this.color,flipX:this.flipX,flipY:this.flipY,collider:this.collider?{...this.collider}:null,...t};return new this.constructor(t.name||this.name,t.spriteName||this.spriteName,e)}toString(){let t=this.hasCollision()?` (${this.isTrigger()?"trigger":"solid"})`:"";return`Tile[${this.name}: ${this.spriteName}${t}]`}}});var I,lt=E(()=>{I=class{static{h(this,"TileRegistry")}static tiles=new Map;static _addTile(t,e){this.tiles.set(t,e)}static getTile(t){return this.tiles.get(t)||null}static hasTile(t){return this.tiles.has(t)}static getAllTileNames(){return Array.from(this.tiles.keys())}static getAllTiles(){return Array.from(this.tiles.values())}static removeTile(t){return this.tiles.delete(t)}static clear(){this.tiles.clear()}static getCount(){return this.tiles.size}static registerTile(t,e){return this.hasTile(t)?(console.warn(`TileRegistry: Tile "${t}" already exists. Use forceRegisterTile() to override.`),!1):(this.tiles.set(t,e),!0)}static forceRegisterTile(t,e){this.tiles.set(t,e)}static createTilesFromMetadata(t){let{TileAsset:e}=(bt(),_t(Gt));return t.map(i=>e.meta(i))}static exportAllToMetadata(){return Array.from(this.tiles.values()).map(t=>t.toMeta?t.toMeta():{name:t.name,spriteName:t.spriteName,options:{width:t.width,height:t.height,opacity:t.opacity,color:t.color,flipX:t.flipX,flipY:t.flipY,collider:t.collider}})}static getTilesByFilter(t){return Array.from(this.tiles.values()).filter(t)}static debugPrint(t=!1){console.log(`TileRegistry: ${this.getCount()} tiles registered`),t?this.tiles.forEach((e,i)=>{console.log(`  - ${i}: ${e.toString()}`)}):console.log(`  Names: [${this.getAllTileNames().join(", ")}]`)}}});var Gt={};it(Gt,{TileAsset:()=>ht});var ht,bt=E(()=>{at();lt();ht=class o extends R{static{h(this,"TileAsset")}constructor(t,e,i={}){if(t.includes(":"))throw new Error(`TileAsset name "${t}" cannot contain colons. Colons are reserved for potential future tile notation.`);super(t,e,i),this._registerSelf()}_registerSelf(){I._addTile(this.name,this)}static meta(t){if(!t.name||typeof t.name!="string"||t.name.trim()==="")throw new Error("TileAsset.meta() requires a valid name string");if(!t.spriteName||typeof t.spriteName!="string"||t.spriteName.trim()==="")throw new Error("TileAsset.meta() requires a valid spriteName string");return new o(t.name,t.spriteName,t.options||{})}static getDefaultMeta(){return{name:"",spriteName:"",options:{width:null,height:null,opacity:1,color:"#FFFFFF",flipX:!1,flipY:!1,collider:null}}}toMeta(){return{name:this.name,spriteName:this.spriteName,options:{width:this.width,height:this.height,opacity:this.opacity,color:this.color,flipX:this.flipX,flipY:this.flipY,collider:this.collider?{...this.collider}:null}}}applyMeta(t){if(t.name!==void 0&&(this.name=t.name),t.spriteName!==void 0&&(this.spriteName=t.spriteName),t.options){let e=t.options;e.width!==void 0&&(this.width=e.width),e.height!==void 0&&(this.height=e.height),e.opacity!==void 0&&(this.opacity=e.opacity),e.color!==void 0&&(this.color=e.color),e.flipX!==void 0&&(this.flipX=e.flipX),e.flipY!==void 0&&(this.flipY=e.flipY),e.collider!==void 0&&(this.collider=e.collider?{...e.collider}:null)}}}});var ee={};it(ee,{AudioAsset:()=>st,AudioClip:()=>K,AudioListenerComponent:()=>T,AudioSourceComponent:()=>zt,BoxColliderComponent:()=>Tt,CameraComponent:()=>j,CircleColliderComponent:()=>Z,Component:()=>m,Destroy:()=>Rt,DestroyAll:()=>$t,DestroyComponent:()=>It,FollowTarget:()=>Pt,Game:()=>f,GameObject:()=>D,GamepadInput:()=>Y,ImageComponent:()=>kt,Instantiate:()=>F,Keyboard:()=>rt,KeyboardInput:()=>U,LayerManager:()=>q,MonoBehaviour:()=>ft,Mouse:()=>Qt,MouseInput:()=>X,MovementComponent:()=>dt,MovementController:()=>Ct,ProceduralAudioClip:()=>x,Random:()=>Lt,RandomAudioGenerator:()=>Bt,RigidbodyComponent:()=>H,Scene:()=>Mt,ShapeComponent:()=>At,SpriteAnimationClip:()=>wt,SpriteAnimationComponent:()=>vt,SpriteAsset:()=>xt,SpriteRegistry:()=>k,SpriteRendererComponent:()=>W,SpritesheetAsset:()=>St,Tile:()=>R,TileAsset:()=>ht,TileRegistry:()=>I,TilemapComponent:()=>Dt,Time:()=>S,Vector2:()=>y,Vector3:()=>Ft,clearPendingDestructions:()=>Kt,getPendingDestructionCount:()=>Nt});var k=class{static{h(this,"SpriteRegistry")}static sprites=new Map;static spritesheets=new Map;static _addSprite(t,e){this.sprites.set(t,e)}static _addSpritesheet(t,e){this.spritesheets.set(t,e)}static getSprite(t){return this.sprites.get(t)||null}static getSpritesheet(t){return this.spritesheets.get(t)||null}static async preloadAll(){let t=Array.from(this.sprites.values()).filter(i=>i.load&&typeof i.load=="function").map(i=>i.isLoaded?Promise.resolve():i.load()),e=Array.from(this.spritesheets.values()).map(i=>i.isLoaded?Promise.resolve():i.load());await Promise.all([...t,...e])}static hasSprite(t){return this.sprites.has(t)}static hasSpritesheet(t){return this.spritesheets.has(t)}static getSpriteNames(){return Array.from(this.sprites.keys())}static getSpritesheetNames(){return Array.from(this.spritesheets.keys())}static getSpritesFromSheet(t){let e=[];for(let i of this.sprites.keys())i.startsWith(t+":")&&e.push(i);return e}static clear(){this.sprites.clear(),this.spritesheets.clear()}static removeSprite(t){return this.sprites.delete(t)}static removeSpritesheet(t){return this.spritesheets.delete(t)}constructor(){this.sheets=new Map,console.warn("SpriteRegistry instance methods are deprecated. Use static methods instead.")}add(t){console.warn("SpriteRegistry.add() is deprecated. Use new SpritesheetAsset() instead."),this.sheets.set(t.name,t)}async preload(){console.warn("SpriteRegistry.preload() is deprecated. Use SpriteRegistry.preloadAll() instead.");for(let t of this.sheets.values())await t.load()}getSheet(t){return console.warn("SpriteRegistry.getSheet() is deprecated. Use SpriteRegistry.getSpritesheet() instead."),this.sheets.get(t)}};nt();var m=class{static{h(this,"Component")}constructor(){this.gameObject=null,this.enabled=!0,this._started=!1,this._internalGizmos=this._internalGizmos||(f.instance?._internalGizmos??!1),this.__meta=this.constructor.getDefaultMeta(),arguments.length>0&&this._applyConstructorArgs(...arguments)}static meta(t){let e=new this;return e.applyMeta(t),e}applyMeta(t){let e={...this.__meta,...t};this.__meta=e,this._updatePropertiesFromMeta(),this._validateMeta()}static getDefaultMeta(){return{}}_applyConstructorArgs(...t){}_updatePropertiesFromMeta(){}_validateMeta(){}__lateStart(){}__update(){}__draw(t){this.enabled&&typeof this.draw=="function"&&this.draw(t),this._internalGizmos&&this.__internalGizmos(t),this.OnDrawGizmos&&typeof this.OnDrawGizmos=="function"&&this.OnDrawGizmos(t)}__preload(){}__internalGizmos(t){}start(){}update(){}draw(t){}async preload(){}destroy(){}lateUpdate(){}},ft=class extends m{static{h(this,"MonoBehaviour")}constructor(){super()}};var y=class o{static{h(this,"Vector2")}constructor(t=0,e=0){this.x=t,this.y=e}static get zero(){return new o(0,0)}static get one(){return new o(1,1)}static get up(){return new o(0,1)}static get down(){return new o(0,-1)}static get left(){return new o(-1,0)}static get right(){return new o(1,0)}static get positiveInfinity(){return new o(1/0,1/0)}static get negativeInfinity(){return new o(-1/0,-1/0)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get sqrMagnitude(){return this.x*this.x+this.y*this.y}get normalized(){let t=this.magnitude;return t===0?o.zero:new o(this.x/t,this.y/t)}add(t){return new o(this.x+t.x,this.y+t.y)}subtract(t){return new o(this.x-t.x,this.y-t.y)}multiply(t){return new o(this.x*t,this.y*t)}divide(t){if(t===0)throw new Error("Cannot divide by zero");return new o(this.x/t,this.y/t)}normalize(){let t=this.magnitude;return t===0?(this.x=0,this.y=0):(this.x/=t,this.y/=t),this}set(t,e){return this.x=t,this.y=e,this}clone(){return new o(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}toString(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}static dot(t,e){return t.x*e.x+t.y*e.y}static distance(t,e){let i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}static sqrDistance(t,e){let i=t.x-e.x,s=t.y-e.y;return i*i+s*s}static lerp(t,e,i){return i=Math.max(0,Math.min(1,i)),new o(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)}static lerpUnclamped(t,e,i){return new o(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)}static min(t,e){return new o(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new o(Math.max(t.x,e.x),Math.max(t.y,e.y))}static moveTowards(t,e,i){let s=e.subtract(t),n=s.magnitude;return n<=i||n===0?e.clone():t.add(s.divide(n).multiply(i))}static reflect(t,e){let i=-2*o.dot(e,t);return new o(i*e.x+t.x,i*e.y+t.y)}static angle(t,e){let i=Math.sqrt(t.sqrMagnitude*e.sqrMagnitude);if(i<1e-15)return 0;let s=Math.max(-1,Math.min(1,o.dot(t,e)/i));return Math.acos(s)}static signedAngle(t,e){let i=o.angle(t,e),s=Math.sign(t.x*e.y-t.y*e.x);return i*s}static clampMagnitude(t,e){let i=t.sqrMagnitude;if(i>e*e){let s=Math.sqrt(i),n=t.x/s,r=t.y/s;return new o(n*e,r*e)}return t.clone()}static rotate(t,e){let i=Math.cos(e),s=Math.sin(e);return new o(t.x*i-t.y*s,t.x*s+t.y*i)}static perpendicular(t){return new o(-t.y,t.x)}static smoothDamp(t,e,i,s,n=1/0,r){s=Math.max(1e-4,s);let a=2/s,l=a*r,c=1/(1+l+.48*l*l+.235*l*l*l),d=t.x-e.x,u=t.y-e.y,p=e.clone(),g=n*s,w=g*g,v=d*d+u*u;if(v>w){let tt=Math.sqrt(v);d=d/tt*g,u=u/tt*g}let A=t.x-d,z=t.y-u,V=(i.x+a*d)*r,Q=(i.y+a*u)*r;i.x=(i.x-a*V)*c,i.y=(i.y-a*Q)*c;let B=A+(d+V)*c,_=z+(u+Q)*c,J=p.x-t.x,$=p.y-t.y,O=B-p.x,N=_-p.y;return J*O+$*N>0&&(B=p.x,_=p.y,i.x=(B-p.x)/r,i.y=(_-p.y)/r),new o(B,_)}};var j=class extends m{static{h(this,"CameraComponent")}constructor(t,e=1){super(),this.canvas=t,this.zoom=e}static getDefaultMeta(){return{zoom:1}}_applyConstructorArgs(t,e=1){let i={zoom:e};this.canvas=t,this.applyMeta(i)}_updatePropertiesFromMeta(){this.zoom=this.__meta.zoom}_validateMeta(){let t=this.__meta;if(typeof t.zoom!="number"||t.zoom<=0)throw new Error("zoom must be a positive number")}applyTransform(t){let e=this.gameObject.getGlobalPosition();t.setTransform(this.zoom,0,0,this.zoom,-e.x*this.zoom+this.canvas.width/2,-e.y*this.zoom+this.canvas.height/2)}};var P=class{static{h(this,"AbstractInputDevice")}constructor(t){this.name=t,this.initialized=!1}initialize(t=null){throw new Error(`InputDevice '${this.name}' must implement initialize() method`)}update(){throw new Error(`InputDevice '${this.name}' must implement update() method`)}isDown(t){throw new Error(`InputDevice '${this.name}' must implement isDown() method`)}isPressed(t){throw new Error(`InputDevice '${this.name}' must implement isPressed() method`)}isReleased(t){throw new Error(`InputDevice '${this.name}' must implement isReleased() method`)}onEvent(t,e,i){console.warn(`InputDevice '${this.name}' does not support event callbacks`)}removeEvent(t,e){console.warn(`InputDevice '${this.name}' does not support event callbacks`)}resolveKey(t){return Array.isArray(t)?t[0]:t}matchesKey(t,e){return Array.isArray(e)?e.includes(t):t===e}getInfo(){return{name:this.name,initialized:this.initialized,type:this.constructor.name}}};var U=class extends P{static{h(this,"KeyboardInput")}constructor(){super("keyboard"),this.keys=new Set,this.pressedKeys=new Set,this.releasedKeys=new Set,this.previousKeys=new Set,this.onKeyDown=new Map,this.onKeyStay=new Map,this.onKeyUp=new Map,this.keyMapping=null}async initialize(t=null){if(!this.initialized)try{let{Keyboard:e}=await Promise.resolve().then(()=>(gt(),Et));this.keyMapping=e,e.initialize&&e.initialize(),this.setupEventListeners(),this.initialized=!0,console.log("\u{1F3B9} Keyboard input initialized")}catch(e){console.error("Failed to initialize keyboard input:",e)}}setupEventListeners(){window.addEventListener("keydown",t=>{let e=this.getLogicalKey(t.key);if(!this.keys.has(e)){this.pressedKeys.add(e);let i=this.onKeyDown.get(e);i&&i(e)}this.keys.add(e)}),window.addEventListener("keyup",t=>{let e=this.getLogicalKey(t.key);this.keys.delete(e),this.releasedKeys.add(e);let i=this.onKeyUp.get(e);i&&i(e)})}update(){if(this.initialized){for(let t of this.keys)if(this.previousKeys.has(t)){let e=this.onKeyStay.get(t);e&&e(t)}this.pressedKeys.clear(),this.releasedKeys.clear(),this.previousKeys=new Set(this.keys)}}getLogicalKey(t){return this.keyMapping&&this.keyMapping.getLogicalKey?this.keyMapping.getLogicalKey(t):t}isDown(t){let e=this.resolveKey(t);return this.keys.has(e)}isPressed(t){let e=this.resolveKey(t);return this.pressedKeys.has(e)}isReleased(t){let e=this.resolveKey(t);return this.releasedKeys.has(e)}onEvent(t,e,i){let s=this.resolveKey(e);switch(t){case"down":this.onKeyDown.set(s,i);break;case"stay":this.onKeyStay.set(s,i);break;case"up":this.onKeyUp.set(s,i);break;default:console.warn(`Unknown keyboard event: ${t}`)}}removeEvent(t,e){let i=this.resolveKey(e);switch(t){case"down":this.onKeyDown.delete(i);break;case"stay":this.onKeyStay.delete(i);break;case"up":this.onKeyUp.delete(i);break}}clearAllEvents(){this.onKeyDown.clear(),this.onKeyStay.clear(),this.onKeyUp.clear()}getInfo(){return{...super.getInfo(),keysHeld:this.keys.size,mappingSystem:this.keyMapping?"Loaded":"Not available",events:{down:this.onKeyDown.size,stay:this.onKeyStay.size,up:this.onKeyUp.size}}}};var X=class extends P{static{h(this,"MouseInput")}constructor(){super("mouse"),this.buttons=new Set,this.pressedButtons=new Set,this.releasedButtons=new Set,this.previousButtons=new Set,this.position={x:0,y:0},this.lastPosition={x:0,y:0},this.onButtonDown=new Map,this.onButtonStay=new Map,this.onButtonUp=new Map,this.onMove=new Set,this.canvas=null}initialize(t=null){this.initialized||(this.canvas=t,this.setupEventListeners(),this.initialized=!0,console.log("\u{1F5B1}\uFE0F Mouse input initialized"))}setupEventListeners(){let t=this.canvas||window;t.addEventListener("mousedown",e=>{let i=e.button;if(!this.buttons.has(i)){this.pressedButtons.add(i);let s=this.onButtonDown.get(i);s&&s(i,this.position)}this.buttons.add(i),this.updatePosition(e)}),t.addEventListener("mouseup",e=>{let i=e.button;this.buttons.delete(i),this.releasedButtons.add(i);let s=this.onButtonUp.get(i);s&&s(i,this.position),this.updatePosition(e)}),t.addEventListener("mousemove",e=>{this.updatePosition(e);for(let i of this.onMove)i(this.position,this.lastPosition)}),this.canvas&&this.canvas.addEventListener("contextmenu",e=>e.preventDefault())}updatePosition(t){if(this.lastPosition={...this.position},this.canvas){let e=this.canvas.getBoundingClientRect();this.position.x=t.clientX-e.left,this.position.y=t.clientY-e.top}else this.position.x=t.clientX,this.position.y=t.clientY}update(){if(this.initialized){for(let t of this.buttons)if(this.previousButtons.has(t)){let e=this.onButtonStay.get(t);e&&e(t,this.position)}this.pressedButtons.clear(),this.releasedButtons.clear(),this.previousButtons=new Set(this.buttons)}}isDown(t){let e=this.resolveKey(t);return this.buttons.has(e)}isPressed(t){let e=this.resolveKey(t);return this.pressedButtons.has(e)}isReleased(t){let e=this.resolveKey(t);return this.releasedButtons.has(e)}getPosition(){return{...this.position}}getDelta(){return{x:this.position.x-this.lastPosition.x,y:this.position.y-this.lastPosition.y}}onEvent(t,e,i=null){if(t==="move"){this.onMove.add(e);return}let s=e,n=this.resolveKey(s);switch(t){case"down":this.onButtonDown.set(n,i);break;case"stay":this.onButtonStay.set(n,i);break;case"up":this.onButtonUp.set(n,i);break;default:console.warn(`Unknown mouse event: ${t}`)}}removeEvent(t,e){if(t==="move"){this.onMove.delete(e);return}let i=e,s=this.resolveKey(i);switch(t){case"down":this.onButtonDown.delete(s);break;case"stay":this.onButtonStay.delete(s);break;case"up":this.onButtonUp.delete(s);break}}clearAllEvents(){this.onButtonDown.clear(),this.onButtonStay.clear(),this.onButtonUp.clear(),this.onMove.clear()}getInfo(){return{...super.getInfo(),position:this.position,buttonsHeld:this.buttons.size,canvas:this.canvas?"Connected":"Global",events:{down:this.onButtonDown.size,stay:this.onButtonStay.size,up:this.onButtonUp.size,move:this.onMove.size}}}},Qt={Left:[0,"left","primary"],Middle:[1,"middle","auxiliary"],Right:[2,"right","secondary"],Back:[3,"back"],Forward:[4,"forward"]};var Y=class extends P{static{h(this,"GamepadInput")}constructor(){super("gamepad"),this.gamepad=null,this.gamepadIndex=0,this.buttons=new Set,this.pressedButtons=new Set,this.releasedButtons=new Set,this.previousButtons=new Set,this.leftStick={x:0,y:0},this.rightStick={x:0,y:0},this.deadzone=.1,this.triggers={left:0,right:0},this.onButtonDown=new Map,this.onButtonStay=new Map,this.onButtonUp=new Map,this.onStickMove=new Map,this.onTriggerMove=new Map,this.onConnected=new Set,this.onDisconnected=new Set}initialize(t=0){this.initialized||(this.gamepadIndex=t,this.setupEventListeners(),this.updateGamepadState(),this.initialized=!0,console.log(`\u{1F3AE} Gamepad input initialized (index: ${t})`))}setupEventListeners(){window.addEventListener("gamepadconnected",t=>{if(t.gamepad.index===this.gamepadIndex){this.gamepad=t.gamepad,console.log(`\u{1F3AE} Gamepad connected: ${t.gamepad.id}`);for(let e of this.onConnected)e(t.gamepad)}}),window.addEventListener("gamepaddisconnected",t=>{if(t.gamepad.index===this.gamepadIndex){this.gamepad=null,console.log(`\u{1F3AE} Gamepad disconnected: ${t.gamepad.id}`);for(let e of this.onDisconnected)e(t.gamepad);this.buttons.clear(),this.pressedButtons.clear(),this.releasedButtons.clear(),this.previousButtons.clear()}})}update(){if(this.initialized&&(this.updateGamepadState(),!!this.gamepad)){this.updateButtonStates(),this.updateAnalogSticks(),this.updateTriggers();for(let t of this.buttons)if(this.previousButtons.has(t)){let e=this.onButtonStay.get(t);e&&e(t)}this.pressedButtons.clear(),this.releasedButtons.clear(),this.previousButtons=new Set(this.buttons)}}updateGamepadState(){let t=navigator.getGamepads();t[this.gamepadIndex]&&(this.gamepad=t[this.gamepadIndex])}updateButtonStates(){if(this.gamepad)for(let t=0;t<this.gamepad.buttons.length;t++){let e=this.gamepad.buttons[t].pressed;if(e&&!this.buttons.has(t)){this.pressedButtons.add(t),this.buttons.add(t);let i=this.onButtonDown.get(t);i&&i(t)}else if(!e&&this.buttons.has(t)){this.releasedButtons.add(t),this.buttons.delete(t);let i=this.onButtonUp.get(t);i&&i(t)}}}updateAnalogSticks(){if(!this.gamepad||this.gamepad.axes.length<4)return;let t={x:this.applyDeadzone(this.gamepad.axes[0]),y:this.applyDeadzone(this.gamepad.axes[1])},e={x:this.applyDeadzone(this.gamepad.axes[2]),y:this.applyDeadzone(this.gamepad.axes[3])};if(this.stickMoved(this.leftStick,t)){this.leftStick=t;let i=this.onStickMove.get("left");i&&i("left",this.leftStick)}if(this.stickMoved(this.rightStick,e)){this.rightStick=e;let i=this.onStickMove.get("right");i&&i("right",this.rightStick)}}updateTriggers(){if(this.gamepad){if(this.gamepad.buttons[6]){let t=this.gamepad.buttons[6].value;if(Math.abs(this.triggers.left-t)>.01){this.triggers.left=t;let e=this.onTriggerMove.get("left");e&&e("left",t)}}if(this.gamepad.buttons[7]){let t=this.gamepad.buttons[7].value;if(Math.abs(this.triggers.right-t)>.01){this.triggers.right=t;let e=this.onTriggerMove.get("right");e&&e("right",t)}}}}applyDeadzone(t){return Math.abs(t)<this.deadzone?0:t}stickMoved(t,e){return Math.abs(t.x-e.x)>.01||Math.abs(t.y-e.y)>.01}isDown(t){let e=this.resolveKey(t);return this.buttons.has(e)}isPressed(t){let e=this.resolveKey(t);return this.pressedButtons.has(e)}isReleased(t){let e=this.resolveKey(t);return this.releasedButtons.has(e)}getStick(t){return t==="left"?{...this.leftStick}:{...this.rightStick}}getTrigger(t){return this.triggers[t]||0}isConnected(){return this.gamepad!==null}setDeadzone(t){this.deadzone=Math.max(0,Math.min(1,t))}onEvent(t,e,i=null){if(t==="connected"||t==="disconnected"){(t==="connected"?this.onConnected:this.onDisconnected).add(e);return}let s=e,n=this.resolveKey(s);switch(t){case"down":this.onButtonDown.set(n,i);break;case"stay":this.onButtonStay.set(n,i);break;case"up":this.onButtonUp.set(n,i);break;case"stick":this.onStickMove.set(n,i);break;case"trigger":this.onTriggerMove.set(n,i);break;default:console.warn(`Unknown gamepad event: ${t}`)}}removeEvent(t,e){if(t==="connected"||t==="disconnected"){(t==="connected"?this.onConnected:this.onDisconnected).delete(e);return}let i=e,s=this.resolveKey(i);switch(t){case"down":this.onButtonDown.delete(s);break;case"stay":this.onButtonStay.delete(s);break;case"up":this.onButtonUp.delete(s);break;case"stick":this.onStickMove.delete(s);break;case"trigger":this.onTriggerMove.delete(s);break}}clearAllEvents(){this.onButtonDown.clear(),this.onButtonStay.clear(),this.onButtonUp.clear(),this.onStickMove.clear(),this.onTriggerMove.clear(),this.onConnected.clear(),this.onDisconnected.clear()}getInfo(){return{...super.getInfo(),connected:this.isConnected(),gamepadId:this.gamepad?this.gamepad.id:"None",buttonsHeld:this.buttons.size,leftStick:this.leftStick,rightStick:this.rightStick,triggers:this.triggers,deadzone:this.deadzone,events:{down:this.onButtonDown.size,stay:this.onButtonStay.size,up:this.onButtonUp.size,stick:this.onStickMove.size,trigger:this.onTriggerMove.size,connected:this.onConnected.size,disconnected:this.onDisconnected.size}}}};var M=class o{static{h(this,"Input")}static keyboard=new U;static mouse=new X;static gamepad=new Y;static devices=new Map;static deviceMappings=new Map;static initialized=!1;static initialize(t=null,e={}){o.initialized||(o.registerDevice("keyboard",o.keyboard),o.registerDevice("mouse",o.mouse),o.registerDevice("gamepad",o.gamepad),o.keyboard.initialize(),o.mouse.initialize(t),o.gamepad.initialize(e.gamepadIndex||0),o.initialized=!0,console.log("\u{1F3AE} Input system initialized with devices:",[...o.devices.keys()]))}static update(){if(o.initialized)for(let t of o.devices.values())t.update()}static registerDevice(t,e){o.devices.set(t,e),o.hasOwnProperty(t)||(o[t]=e),console.log(`\u{1F4E5} Registered input device: ${t}`)}static unregisterDevice(t){if(o.devices.has(t)){let e=o.devices.get(t);e.initialized&&e.clearAllEvents(),o.devices.delete(t),o.hasOwnProperty(t)&&delete o[t],console.log(`\u{1F4E4} Unregistered input device: ${t}`)}}static registerMapping(t,e){o.deviceMappings.has(t)||o.deviceMappings.set(t,new Map);let i=o.deviceMappings.get(t);for(let[s,n]of Object.entries(e))i.set(s,Array.isArray(n)?n:[n]);console.log(`\u{1F5C2}\uFE0F Registered custom mappings for ${t}:`,Object.keys(e))}static getDevice(t){return o.devices.get(t)||null}static getDeviceNames(){return[...o.devices.keys()]}static isDeviceReady(t){let e=o.devices.get(t);return e&&e.initialized}static getSystemInfo(){let t={};for(let[e,i]of o.devices.entries())t[e]=i.getInfo();return{initialized:o.initialized,totalDevices:o.devices.size,customMappings:o.deviceMappings.size,devices:t}}static clearAll(){for(let t of o.devices.values())t.clearAllEvents&&t.clearAllEvents();console.log("\u{1F9F9} Cleared all input events and state")}static shutdown(){o.clearAll(),o.devices.clear(),o.deviceMappings.clear(),delete o.keyboard,delete o.mouse,delete o.gamepad,o.initialized=!1,console.log("\u{1F50C} Input system shutdown")}static isDown(t){return console.warn("\u26A0\uFE0F Input.isDown() is deprecated. Use Input.keyboard.isDown(key) instead."),o.keyboard.isDown(t)}static isPressed(t){return console.warn("\u26A0\uFE0F Input.isPressed() is deprecated. Use Input.keyboard.isPressed(key) instead."),o.keyboard.isPressed(t)}static isReleased(t){return console.warn("\u26A0\uFE0F Input.isReleased() is deprecated. Use Input.keyboard.isReleased(key) instead."),o.keyboard.isReleased(t)}static isMouseDown(t){return console.warn("\u26A0\uFE0F Input.isMouseDown() is deprecated. Use Input.mouse.isDown(button) instead."),o.mouse.isDown(t)}static getMousePosition(){return console.warn("\u26A0\uFE0F Input.getMousePosition() is deprecated. Use Input.mouse.getPosition() instead."),o.mouse.getPosition()}static onEvent(t,e,i){console.warn("\u26A0\uFE0F Input.onEvent() is deprecated. Use Input.keyboard.onEvent() or Input.mouse.onEvent() instead."),o.keyboard.onEvent(t,e,i)}static isKeyDown(t){return console.warn("\u26A0\uFE0F Input.isKeyDown() is deprecated. Use Input.keyboard.isDown(key) instead."),o.keyboard.isDown(t)}static isKeyPressed(t){return console.warn("\u26A0\uFE0F Input.isKeyPressed() is deprecated. Use Input.keyboard.isPressed(key) instead."),o.keyboard.isPressed(t)}static isMousePressed(t){return console.warn("\u26A0\uFE0F Input.isMousePressed() is deprecated. Use Input.mouse.isPressed(button) instead."),o.mouse.isPressed(t)}static isLeftMouseDown(){return console.warn("\u26A0\uFE0F Input.isLeftMouseDown() is deprecated. Use Input.mouse.isDown(0) instead."),o.mouse.isDown(0)}static isRightMouseDown(){return console.warn("\u26A0\uFE0F Input.isRightMouseDown() is deprecated. Use Input.mouse.isDown(2) instead."),o.mouse.isDown(2)}};var C=class extends m{static{h(this,"AbstractColliderComponent")}constructor(){super(),this.trigger=!1,this._lastCollisions=new Set}isTrigger(){return this.trigger===!0}start(){b.instance.register(this)}destroy(){b.instance.unregister(this)}checkCollisionWith(t){throw new Error("checkCollisionWith must be implemented")}getBounds(){throw new Error("getBounds must be implemented")}};var b=class o{static{h(this,"CollisionSystem")}constructor(){this.colliders=new Set,o.instance=this}register(t){this.colliders.add(t)}unregister(t){this.colliders.delete(t)}update(){}intersects(t,e){return t instanceof C&&e instanceof C?t.checkCollisionWith(e):(console.warn("INTERNAL_ERROR:At least one object is not an collider component:",t,e),!1)}};b.instance=void 0;var D=class o{static{h(this,"GameObject")}constructor(t=0,e=0){t instanceof y?this.position=t.clone():this.position=new y(t,e),this.rotation=0,this.components=[],this.children=[],this.parent=null,this.name="",this.tags=new Set,this.paused=!1,this.layer="default",this.zIndex=0}addComponent(t){if(!(t instanceof m))throw new Error('addComponent: property "component" must be an instance of Component');if(this.getComponent(t.constructor))throw new Error(`Component of type ${t.constructor.name} already exists on this GameObject.`);return t.gameObject=this,this.components.push(t),t}addComponents(t){if(!Array.isArray(t))throw new Error('addComponents: property "components" must be an array of Component instances');for(let i of t){if(!(i instanceof m))throw new Error("addComponents: all items must be instances of Component");if(this.getComponent(i.constructor))throw new Error(`Component of type ${i.constructor.name} already exists on this GameObject.`)}let e=[];for(let i of t)i.gameObject=this,this.components.push(i),e.push(i);return e}getComponent(t){if(typeof t!="function"||!t.prototype)throw new Error('getComponent: property "type" must be a class');return this.components.find(e=>e instanceof t)}hasComponent(t){if(typeof t!="function"||!t.prototype)throw new Error('hasComponent: property "type" must be a class');return!!this.getComponent(t)}removeComponent(t){let e=this.components.findIndex(i=>i instanceof t);e!==-1&&(this.components[e].destroy?.(),this.components.splice(e,1))}getComponentInChildren(t){if(typeof t!="function"||!t.prototype)throw new Error('hasComponent: property "type" must be a class');return this.children.find(e=>e.hasComponent(t)).getComponent(t)}hasTag(t){return this.tags.has(t)}addTag(t){this.tags.add(t)}__addChild(t){if(!(t instanceof o))throw new Error(`Nity2D: method 'addChild' only accepts GameObject, '${typeof t}' provided`);this.children.push(t),t.parent=this}addChild(t){F.create(t,{parent:this,addToScene:!0})}addChildren(t){if(!Array.isArray(t))throw new Error(`Nity2D: method 'addChildren' only accepts array '${typeof t}' provided`);t.forEach(e=>this.addChild(e))}removeChild(t){let e=this.children.indexOf(t);e!==-1&&(t.parent=null,this.children.splice(e,1))}getGlobalPosition(){return this.parent?this.position.add(this.parent.getGlobalPosition()):this.position.clone()}getGlobalRotation(){return this.parent?this.rotation+this.parent.getGlobalRotation():this.rotation}setPosition(t,e){t instanceof y?this.position.set(t.x,t.y):this.position.set(t,e)}setRotation(t){this.rotation=t}setRotationDegrees(t){this.rotation=t*(Math.PI/180)}getRotationDegrees(){return this.rotation*(180/Math.PI)}getGlobalRotationDegrees(){return this.getGlobalRotation()*(180/Math.PI)}rotate(t){this.rotation+=t}rotateDegrees(t){this.rotation+=t*(Math.PI/180)}translate(t,e){t instanceof y?this.position=this.position.add(t):this.position=this.position.add(new y(t,e))}async preload(){let t=this.components.map(e=>e.preload?.());for(let e of this.children)t.push(e.preload?.());await Promise.all(t)}start(){for(let t of this.components)t.enabled&&typeof t.start=="function"&&t.start();for(let t of this.children)t.start()}update(){if(!this.paused){for(let t of this.components)t.enabled&&typeof t.update=="function"&&t.update();for(let t of this.children)t.update()}}lateUpdate(){if(!this.paused){for(let t of this.components)t.enabled&&typeof t.lateUpdate=="function"&&t.lateUpdate();for(let t of this.children)t.lateUpdate()}}onCollisionEnter(t){for(let e of this.components)typeof e.onCollisionEnter=="function"&&e.onCollisionEnter(t)}onCollisionStay(t){for(let e of this.components)typeof e.onCollisionStay=="function"&&e.onCollisionStay(t)}onCollisionExit(t){for(let e of this.components)typeof e.onCollisionExit=="function"&&e.onCollisionExit(t)}__draw(t){if(!this.paused){for(let e of this.components)e.__draw(t);for(let e of this.children)e.__draw(t)}}};var F=class o{static{h(this,"Instantiate")}static create(t,e={},...i){let{x:s,y:n,parent:r=null,addToScene:a=!0}=e,l;if(typeof t=="function")l=new t(s??0,n??0,...i);else if(t instanceof D)l=t,s!==void 0&&(l.x=s),n!==void 0&&(l.y=n);else throw new Error("Instantiate.create: prefab must be a GameObject instance or constructor function");if(r){if(!(r instanceof D))throw new Error("Instantiate.create: parent must be a GameObject instance");r.__addChild(l)}if(a&&!r&&f.instance?.scene&&(f.instance.scene.__addObjectToScene(l),f.instance.hasLayerSystem())){let c=l.layer||f.instance.getDefaultLayer();f.instance.addToLayer(c,l)}return o._registerGameObject(l),l}static _registerGameObject(t){for(let e of t.components)o._registerComponent(e);for(let e of t.children)o._registerGameObject(e)}static _registerComponent(t){t instanceof C&&(b.instance?b.instance.register(t):(console.warn("CollisionSystem not initialized. Collider will be registered when system is available:",t),o._pendingColliders||(o._pendingColliders=[]),o._pendingColliders.push(t))),typeof t.start=="function"&&t.start()}static registerPendingColliders(){if(o._pendingColliders&&b.instance){for(let t of o._pendingColliders)b.instance.register(t);o._pendingColliders=[]}}static destroy(t){if(!(t instanceof D))throw new Error("Instantiate.destroy: gameObject must be a GameObject instance");for(let e of[...t.children])o.destroy(e);for(let e of t.components)o._unregisterComponent(e);if(t.parent&&t.parent.removeChild(t),f.instance?.scene){let e=f.instance.scene.objects.indexOf(t);e!==-1&&f.instance.scene.objects.splice(e,1)}}static _unregisterComponent(t){t instanceof C&&b.instance&&b.instance.unregister(t),typeof t.destroy=="function"&&t.destroy()}static clone(t,e={}){if(!(t instanceof D))throw new Error("Instantiate.clone: original must be a GameObject instance");let i=new D(t.x,t.y);i.name=t.name,i.tags=new Set(t.tags);for(let l of t.components){let c=l.constructor,d=new c;for(let u in l)l.hasOwnProperty(u)&&u!=="gameObject"&&(d[u]=l[u]);i.addComponent(d)}for(let l of t.children){let c=o.clone(l,{addToScene:!1});i.__addChild(c)}let{x:s=i.x,y:n=i.y,parent:r=null,addToScene:a=!0}=e;return i.x=s,i.y=n,r&&r.__addChild(i),a&&!r&&f.instance?.scene&&f.instance.scene.__addObjectToScene(i),o._registerGameObject(i),i}};var S=class{static{h(this,"Time")}static#t=performance.now();static#i=performance.now();static#s=0;static#r=1e3;static#o=performance.now();static#n=60;static#e=1;static get deltaTime(){return f.instance?._deltaTime||0}static get unscaleddeltaTime(){return(f.instance?._deltaTime||0)/this.#e}static get time(){return(performance.now()-this.#t)/1e3*this.#e}static get unscaledTime(){return(performance.now()-this.#t)/1e3}static get fps(){return this.#n}static get frameCount(){return this.#s}static get timeScale(){return this.#e}static set timeScale(t){this.#e=Math.max(0,t)}static get timestamp(){return performance.now()}static get realtimeSinceStartup(){return Date.now()}static _updateTimeStats(){let t=performance.now();if(this.#s++,t-this.#o>=this.#r){let e=t-this.#o,i=this.#s-(this.#o===performance.now()?0:Math.floor(e/16.67));this.#n=Math.round(1e3/(e/i))||60,this.#o=t}this.#i=t}static secondsToMilliseconds(t){return t*1e3}static millisecondsToSeconds(t){return t/1e3}static createTimer(t){let e=this.time;return()=>this.time-e>=t}static createInterval(t){let e=this.time;return()=>this.time-e>=t?(e=this.time,!0):!1}static lerp(t,e,i){return t+(e-t)*(1-Math.exp(-i*this.deltaTime))}static _reset(){this.#t=performance.now(),this.#i=performance.now(),this.#s=0,this.#o=performance.now(),this.#n=60,this.#e=1}};var G=[];function Rt(o,t=0){if(t<=0)yt(o);else{let e=performance.now()+t*1e3;G.push({target:o,time:e})}}h(Rt,"Destroy");function It(o,t){if(!o||!o.components){console.warn("DestroyComponent: Invalid GameObject provided");return}let e=o.getComponent(t);e?(typeof e.destroy=="function"&&e.destroy(),o.removeComponent(t),console.log(`DestroyComponent: Removed ${t.name} from ${o.name||"GameObject"}`)):console.warn(`DestroyComponent: Component ${t.name} not found on GameObject`)}h(It,"DestroyComponent");function $t(){let o=f.instance;if(!o||!o.currentScene){console.warn("DestroyAll: No active scene found");return}let t=[...o.currentScene.objects];t.forEach(e=>yt(e)),console.log(`DestroyAll: Destroyed ${t.length} GameObjects`)}h($t,"DestroyAll");function yt(o){if(!o){console.warn("Destroy: Cannot destroy null or undefined target");return}o.components&&Array.isArray(o.components)&&o.position?Jt(o):o.gameObject?te(o):(console.warn("Destroy: Unknown target type, cannot destroy",o),console.warn("Target properties:",Object.keys(o)))}h(yt,"_destroyImmediate");function Jt(o){let t=f.instance;if(!t||!t.currentScene){console.warn("Destroy: No active scene found for GameObject destruction");return}t.currentScene.remove(o),console.log(`Destroy: Destroyed GameObject "${o.name||"Unnamed"}"`)}h(Jt,"_destroyGameObject");function te(o){if(!o.gameObject){console.warn("Destroy: Component has no associated GameObject");return}typeof o.destroy=="function"&&o.destroy();let t=o.constructor;o.gameObject.removeComponent(t),console.log(`Destroy: Destroyed Component ${t.name}`)}h(te,"_destroyComponent");function Ot(){let o=performance.now(),t=[];for(let e=G.length-1;e>=0;e--){let i=G[e];o>=i.time&&(t.push(i.target),G.splice(e,1))}t.forEach(e=>yt(e))}h(Ot,"_processPendingDestructions");function Nt(){return G.length}h(Nt,"getPendingDestructionCount");function Kt(){G=[]}h(Kt,"clearPendingDestructions");var q=class{static{h(this,"LayerManager")}constructor(t,e={}){this.mainCanvas=t,this.mainCtx=t.getContext("2d"),this.config={layers:e.layers||["background","default","ui"],defaultLayer:e.defaultLayer||"default",width:e.width||t.width||800,height:e.height||t.height||600,...e},this.layers=new Map,this.layerContexts=new Map,this.layerContents=new Map,this.dirtyLayers=new Set,this.layerOrder=[...this.config.layers],this.layerZIndex=new Map,this.initializeLayers()}initializeLayers(){this.config.layers.forEach((t,e)=>{let i=new OffscreenCanvas(this.config.width,this.config.height),s=i.getContext("2d");this.layers.set(t,i),this.layerContexts.set(t,s),this.layerContents.set(t,[]),this.layerZIndex.set(t,e*100),this.dirtyLayers.add(t)})}addToLayer(t,e){if(!this.layers.has(t)){console.warn(`LayerManager: Layer "${t}" does not exist`);return}let i=this.layerContents.get(t);i.includes(e)||(i.push(e),e.layer!==void 0&&(e.layer=t),this.markLayerDirty(t))}removeFromLayer(t,e){if(!this.layers.has(t))return;let i=this.layerContents.get(t),s=i.indexOf(e);s!==-1&&(i.splice(s,1),this.markLayerDirty(t))}markLayerDirty(t){this.dirtyLayers.add(t)}markAllLayersDirty(){this.config.layers.forEach(t=>{this.dirtyLayers.add(t)})}renderLayer(t){if(!this.dirtyLayers.has(t))return;let e=this.layerContexts.get(t),i=this.layerContents.get(t);if(!e||!i)return;e.clearRect(0,0,this.config.width,this.config.height),i.slice().sort((n,r)=>{let a=n.zIndex||0,l=r.zIndex||0;return a-l}).forEach(n=>{n.active!==!1&&(e.save(),typeof n.__draw=="function"?n.__draw(e):typeof n.draw=="function"&&n.draw(e),e.restore())}),this.dirtyLayers.delete(t)}render(){this.layerOrder.forEach(t=>{this.dirtyLayers.has(t)&&this.renderLayer(t)}),this.mainCtx.clearRect(0,0,this.mainCanvas.width,this.mainCanvas.height),this.layerOrder.forEach(t=>{let e=this.layers.get(t);e&&this.mainCtx.drawImage(e,0,0)})}getLayerZIndex(t){return this.layerZIndex.get(t)||0}setLayerZIndex(t,e){this.layerZIndex.set(t,e),this.layerOrder.sort((i,s)=>this.getLayerZIndex(i)-this.getLayerZIndex(s))}getDefaultLayer(){return this.config.defaultLayer}clearLayer(t){this.layerContents.has(t)&&(this.layerContents.set(t,[]),this.markLayerDirty(t))}clearAllLayers(){this.layerOrder.forEach(t=>{this.clearLayer(t)})}resize(t,e){this.config.width=t,this.config.height=e,this.mainCanvas.width=t,this.mainCanvas.height=e,this.layers.forEach((i,s)=>{let n=new OffscreenCanvas(t,e),r=n.getContext("2d");this.layers.set(s,n),this.layerContexts.set(s,r),this.markLayerDirty(s)})}getLayerContents(t){return this.layerContents.get(t)||[]}hasLayer(t){return this.layers.has(t)}addLayer(t,e){if(this.hasLayer(t)){console.warn(`LayerManager: Layer "${t}" already exists`);return}let i=new OffscreenCanvas(this.config.width,this.config.height),s=i.getContext("2d");this.layers.set(t,i),this.layerContexts.set(t,s),this.layerContents.set(t,[]);let n=e!==void 0?e:this.layerOrder.length*100;this.layerZIndex.set(t,n),this.layerOrder.push(t),this.layerOrder.sort((r,a)=>this.getLayerZIndex(r)-this.getLayerZIndex(a)),this.markLayerDirty(t)}removeLayer(t){if(!this.hasLayer(t))return;this.layers.delete(t),this.layerContexts.delete(t),this.layerContents.delete(t),this.layerZIndex.delete(t),this.dirtyLayers.delete(t);let e=this.layerOrder.indexOf(t);e!==-1&&this.layerOrder.splice(e,1)}getMemoryStats(){let t=this.layers.size,e=Array.from(this.layerContents.values()).reduce((n,r)=>n+r.length,0),i=this.config.width*this.config.height*4,s=t*i;return{layers:t,objects:e,memoryMB:(s/(1024*1024)).toFixed(2),dirtyLayers:this.dirtyLayers.size,canvasElements:1}}getDebugInfo(){let t=this.getMemoryStats();return`LayerManager: ${t.layers} internal layers, ${t.objects} objects, ${t.memoryMB}MB memory, ${t.dirtyLayers} dirty layers, 1 DOM canvas`}};var f=class o{static{h(this,"Game")}#t=!1;#i=!1;#s=!1;#r=0;constructor(t){if(o.instance=this,t!=null){if(!(t instanceof HTMLCanvasElement))throw new Error("Game constructor requires a valid HTMLCanvasElement.");this.canvas=t,this.ctx=t.getContext("2d")}this.scene=null,this.mainCamera=null,this.layerManager=null,this.useLayerSystem=!1,this.paused=!1,this._internalGizmos=!1,this._debugMode=!1,this._deltaTime=0,new b,F.registerPendingColliders()}configure(t={canvas:null,mainCamera:null,debug:!1,layers:null,defaultLayer:null,useLayerSystem:!1}){if(this.#i||this.#s){console.warn("Game is already initialized. Configuration changes will not take effect.");return}if(t.canvas&&(this.canvas=t.canvas,this.ctx=this.canvas.getContext("2d")),t.mainCamera&&(this.mainCamera=t.mainCamera),t.debug&&this.#u(),t.useLayerSystem&&this.canvas){this.useLayerSystem=!0;let e={layers:t.layers||["background","default","ui"],defaultLayer:t.defaultLayer||"default",width:this.canvas.width,height:this.canvas.height};this.layerManager=new q(this.canvas,e),console.log("LayerManager initialized with layers:",e.layers),console.log("Default layer:",e.defaultLayer)}}launch(t){if(!t&&!this.scene)throw new Error("No scene provided.");if(this.#s){console.warn("Game is already launching or has been launched.");return}else this.#s=!0;if(!t&&!this.scene)throw new Error("No scene assigned to game.");this.#d(),this.#o(t||this.scene)}async loadScene(t){if(!t)throw new Error("No scene provided.");if(!this.#i&&!this.#s){await this.#a(t);return}this.#o(t)}pause(){this.paused=!0}resume(){this.paused=!1}async#o(t){await this.#a(t),this.#n()}#n(){S._reset(),M.initialize(this.canvas),this.#c(),requestAnimationFrame(this.#e.bind(this))}#e(t){if(this._deltaTime=(t-this.#r)/1e3,this._deltaTime>.1&&(this._deltaTime=.1),this.#r=t,S._updateTimeStats(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),!this.#t){if(!this.paused&&(M.update(),this.scene.__update(),this.mainCamera)){let e=this.mainCamera.getComponent(j);e&&e.applyTransform(this.ctx)}this.scene.__lateUpdate(),Ot(),this.useLayerSystem&&this.layerManager?this.layerManager.render():this.scene.__draw(this.ctx)}requestAnimationFrame(this.#e.bind(this))}async#a(t){if(!t)throw new Error("No scene provided.");this.scene=t,this.currentScene=t,await Promise.all([k.preloadAll(),L.preloadAll()]),await this.scene.preload(),await this.scene.start()}#l(){this.#t!==!0&&(this.#t=!0,console.log("Game fullscale pause"))}#h(){this.#t!==!1&&(this.#t=!1,this.#r=performance.now(),console.log("Game fullscale resume"))}#c(){document.addEventListener("visibilitychange",()=>{document.hidden?this.#l():this.#h()})}#d(){if(!this.canvas){console.warn("No canvas element provided.");return}if(this.ctx||console.error("Failed to get 2D context from canvas."),this.ctx.imageSmoothingEnabled=!1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.useLayerSystem&&!this.layerManager){let t={layers:["background","environment","gameplay","effects","ui"],width:this.canvas.width,height:this.canvas.height};this.layerManager=new q(this.canvas,t),console.log("LayerManager initialized in _initCanvas with default layers")}}#u(){this._debugMode=!0,this._internalGizmos=!0}addToLayer(t,e){if(!this.useLayerSystem||!this.layerManager){console.warn("LayerManager not enabled. Use configure({ useLayerSystem: true }) to enable layers.");return}this.layerManager.addToLayer(t,e)}removeFromLayer(t,e){if(!this.useLayerSystem||!this.layerManager){console.warn("LayerManager not enabled.");return}this.layerManager.removeFromLayer(t,e)}getLayerManager(){return this.layerManager}hasLayerSystem(){return this.useLayerSystem&&this.layerManager!==null}getDefaultLayer(){return this.layerManager?this.layerManager.getDefaultLayer():"default"}};f.instance=null;var wt=class o{static{h(this,"SpriteAnimationClip")}constructor(t,e=[],i=10,s=!0){this.name=t,this.spriteNames=e,this.fps=i,this.loop=s}static meta(t={}){let i={...this.getDefaultMeta(),...t};return this.validateMeta(i),new this(i.name,i.spriteNames,i.fps,i.loop)}static getDefaultMeta(){return{name:"",spriteNames:[],fps:10,loop:!0}}static validateMeta(t){if(typeof t.name!="string")throw new Error("SpriteAnimationClip metadata: name must be a string");if(t.name.trim()==="")throw new Error("SpriteAnimationClip metadata: name cannot be empty");if(!Array.isArray(t.spriteNames))throw new Error("SpriteAnimationClip metadata: spriteNames must be an array");if(t.spriteNames.some(e=>typeof e!="string"))throw new Error("SpriteAnimationClip metadata: all spriteNames must be strings");if(typeof t.fps!="number"||t.fps<=0)throw new Error("SpriteAnimationClip metadata: fps must be a positive number");if(typeof t.loop!="boolean")throw new Error("SpriteAnimationClip metadata: loop must be a boolean")}applyMeta(t){let i={...this.constructor.getDefaultMeta(),...t};this.constructor.validateMeta(i),this.name=i.name,this.spriteNames=i.spriteNames,this.fps=i.fps,this.loop=i.loop}toMeta(){return{name:this.name,spriteNames:[...this.spriteNames],fps:this.fps,loop:this.loop}}clone(){return new o(this.name,[...this.spriteNames],this.fps,this.loop)}};var W=class extends m{static{h(this,"SpriteRendererComponent")}constructor(t,e={}){super(),this.spriteKey=t,this.sprite=null,this.options={width:e.width||null,height:e.height||null,opacity:e.opacity!==void 0?e.opacity:1,color:e.color||"#FFFFFF",flipX:e.flipX||!1,flipY:e.flipY||!1}}static getDefaultMeta(){return{spriteName:"",width:null,height:null,opacity:1,color:"#FFFFFF",flipX:!1,flipY:!1}}_applyConstructorArgs(t,e={}){let i={spriteName:t||"",width:e.width||null,height:e.height||null,opacity:e.opacity!==void 0?e.opacity:1,color:e.color||"#FFFFFF",flipX:e.flipX||!1,flipY:e.flipY||!1};this.applyMeta(i)}_updatePropertiesFromMeta(){this.__meta.spriteName&&(this.spriteKey=this.__meta.spriteName),this.options={width:this.__meta.width,height:this.__meta.height,opacity:this.__meta.opacity,color:this.__meta.color,flipX:this.__meta.flipX,flipY:this.__meta.flipY}}_validateMeta(){let t=this.__meta;if(typeof t.spriteName!="string")throw new Error("spriteName must be a string");if(t.width!==null&&(typeof t.width!="number"||t.width<=0))throw new Error("width must be null or a positive number");if(t.height!==null&&(typeof t.height!="number"||t.height<=0))throw new Error("height must be null or a positive number");if(typeof t.opacity!="number"||t.opacity<0||t.opacity>1)throw new Error("opacity must be a number between 0 and 1");if(typeof t.color!="string")throw new Error("color must be a string");if(typeof t.flipX!="boolean")throw new Error("flipX must be a boolean");if(typeof t.flipY!="boolean")throw new Error("flipY must be a boolean")}preload(){if(this.sprite=k.getSprite(this.spriteKey),!this.sprite)throw new Error(`Sprite '${this.spriteKey}' not found in SpriteRegistry. Make sure the sprite or spritesheet is loaded.`)}__draw(t){if(!this.sprite||!this.sprite.image||!this.sprite.isLoaded){console.log(`Sprite '${this.spriteKey}' is not loaded or does not exist.`);return}let e=this.gameObject.getGlobalPosition(),i=this.gameObject.getGlobalRotation(),s=this.options.width||this.sprite.width,n=this.options.height||this.sprite.height,r=this.options.opacity!==1,a=this.options.color!=="#FFFFFF";r&&(t.save(),t.globalAlpha=Math.max(0,Math.min(1,this.options.opacity)));let l=1,c=1;this.options.flipX&&(l=-1),this.options.flipY&&(c=-1),this.sprite.draw(t,e.x,e.y,s,n,i,l,c),a&&(t.save(),t.globalCompositeOperation="source-atop",t.fillStyle=this.options.color,i!==0?(t.translate(e.x,e.y),t.rotate(i),t.fillRect(-s/2,-n/2,s,n)):t.fillRect(e.x-s/2,e.y-n/2,s,n),t.restore()),r&&t.restore()}setSprite(t){this.spriteKey=t,this.sprite=k.getSprite(t),this.sprite||console.warn(`Sprite '${t}' not found in SpriteRegistry.`)}setScale(t,e){this.options.width=t,this.options.height=e}setOptions(t){this.options={...this.options,...t}}getRenderedWidth(){return this.sprite?this.options.width||this.sprite.width:0}getRenderedHeight(){return this.sprite?this.options.height||this.sprite.height:0}getOpacity(){return this.options.opacity}setOpacity(t){this.options.opacity=Math.max(0,Math.min(1,t))}getColor(){return this.options.color}setColor(t){this.options.color=t}getFlipX(){return this.options.flipX}setFlipX(t){this.options.flipX=t}getFlipY(){return this.options.flipY}setFlipY(t){this.options.flipY=t}__internalGizmos(t){if(!this.sprite||!this.sprite.image||!this.sprite.isLoaded)return;let e=this.gameObject.getGlobalPosition(),i=this.gameObject.getGlobalRotation();t.save(),t.translate(e.x,e.y),i!==0&&t.rotate(i),t.strokeStyle="#FF00FF",t.lineWidth=1,t.setLineDash([4,2]);let s=this.getRenderedWidth(),n=this.getRenderedHeight();t.strokeRect(-s/2,-n/2,s,n),t.setLineDash([]),t.fillStyle="#FF00FF",t.beginPath(),t.arc(0,0,2,0,2*Math.PI),t.fill(),t.fillStyle="#FF00FF",t.font="10px Arial",t.textAlign="center",t.fillText(this.spriteKey,0,-n/2-8),t.fillText(`${s}x${n}`,0,n/2+15),t.restore()}};var vt=class extends m{static{h(this,"SpriteAnimationComponent")}constructor(t=null){super(),this.clips=new Map,this.currentClip=null,this.currentFrame=0,this.autoPlay=!0,this.time=0,this.defaultClipName=t}static getDefaultMeta(){return{defaultClipName:null,autoPlay:!0}}_applyConstructorArgs(t=null){let e={defaultClipName:t,autoPlay:!0};this.applyMeta(e)}_updatePropertiesFromMeta(){this.defaultClipName=this.__meta.defaultClipName,this.autoPlay=this.__meta.autoPlay}_validateMeta(){let t=this.__meta;if(t.defaultClipName!==null&&typeof t.defaultClipName!="string")throw new Error("defaultClipName must be null or a string");if(typeof t.autoPlay!="boolean")throw new Error("autoPlay must be a boolean")}start(){this.autoPlay&&this.defaultClipName&&this.play(this.defaultClipName)}addClip(t){this.clips.set(t.name,t)}play(t){let e=this.clips.get(t);if(!e)throw new Error(`Animation clip '${t}' not found.`);this.currentClip=e,this.currentFrame=0,this.time=0,this._applyFrame()}update(){if(!this.currentClip)return;this.time+=S.deltaTime;let t=1/this.currentClip.fps;if(this.time>=t){if(this.time-=t,this.currentFrame++,this.currentFrame>=this.currentClip.spriteNames.length)if(this.currentClip.loop)this.currentFrame=0;else{this.currentFrame=this.currentClip.spriteNames.length-1;return}this._applyFrame()}}_applyFrame(){if(!this.currentClip||!this.currentClip.spriteNames[this.currentFrame])return;let t=this.currentClip.spriteNames[this.currentFrame],e=this.gameObject.getComponent(W);e&&e.setSprite(t)}};at();bt();lt();var Mt=class{static{h(this,"Scene")}constructor({create:t}={}){this.objects=[],this._createFn=t}create(t){}add(t){if(F.create(t),f.instance&&f.instance.hasLayerSystem()){let e=t.layer||f.instance.getDefaultLayer();f.instance.addToLayer(e,t)}}remove(t){let e=this.objects.indexOf(t);e>-1&&(typeof t.destroy=="function"&&t.destroy(),t.components&&t.components.forEach(i=>{typeof i.destroy=="function"&&i.destroy()}),this.objects.splice(e,1),t.scene=null)}__addObjectToScene(t){if(!(t instanceof D))throw new Error(`[Nity] Forbidden object '${t?t.constructor.name:null}' added to the scene. Accepts only 'GameObject'.`);this.objects.push(t)}findByName(t){return this.objects.find(e=>e.name===t)}findByTag(t){return this.objects.filter(e=>e.hasTag(t))}async preload(){typeof this._createFn=="function"&&(await this._createFn(this),this._createFn=null),typeof this.create=="function"&&this.create!==this._createFn&&await this.create(this);let t=this.objects.map(e=>e?.preload?.());await Promise.all(t)}async start(){for(let t of this.objects)typeof t?.start=="function"&&t?.start();setTimeout(()=>{},500)}update(){}lateUpdate(){}__update(){for(let t of this.objects)typeof t?.update=="function"&&t?.update();b.instance?b.instance?.update():console.warn("Scene: CollisionSystem.instance is null!"),this?.update()}__lateUpdate(){for(let t of this.objects)typeof t.lateUpdate=="function"&&t?.lateUpdate();this?.lateUpdate()}__draw(t){for(let e of this.objects)e.__draw(t)}};var ct=class extends m{static{h(this,"GravityComponent")}constructor(t={gravityScale:300}){super(),this.gravity=!0,this.gravityScale=t.gravityScale||300,this.velocity=new y(0,0)}static getDefaultMeta(){return{gravityScale:300}}_applyConstructorArgs(t={}){let e={gravityScale:t.gravityScale||300};this.applyMeta(e)}_updatePropertiesFromMeta(){this.gravityScale=this.__meta.gravityScale}_validateMeta(){let t=this.__meta;if(typeof t.gravityScale!="number"||t.gravityScale<0)throw new Error("gravityScale must be a non-negative number")}update(){this.gravity&&(this.velocity.y+=this.gravityScale*S.deltaTime)}_doMove(t,e){t instanceof y?this.gameObject.translate(t):this.gameObject.translate(t,e)}};var H=class o extends ct{static{h(this,"RigidbodyComponent")}#t;#i=new Set;bounciness=0;gravity=!1;gravityScale=300;constructor(t={gravity:!1,gravityScale:300,bounciness:0}){super(t),this.gravity=t.gravity!=null?t.gravity:!1,this.bounciness=t.bounciness||0}static getDefaultMeta(){return{gravity:!1,gravityScale:300,bounciness:0}}_applyConstructorArgs(t={}){let e={gravity:t.gravity!==null?t.gravity:!1,gravityScale:t.gravityScale||300,bounciness:t.bounciness||0};this.applyMeta(e)}_updatePropertiesFromMeta(){this.gravity=this.__meta.gravity,this.gravityScale=this.__meta.gravityScale,this.bounciness=this.__meta.bounciness}_validateMeta(){let t=this.__meta;if(typeof t.gravity!="boolean")throw new Error("gravity must be a boolean");if(typeof t.gravityScale!="number"||t.gravityScale<0)throw new Error("gravityScale must be a non-negative number");if(typeof t.bounciness!="number"||t.bounciness<0||t.bounciness>1)throw new Error("bounciness must be a number between 0 and 1")}start(){this.#t=this.gameObject.getComponent(C),this.#t||console.warn("RigidbodyComponent requires a collider.")}update(){super.update();let t=this.velocity.multiply(S.deltaTime);this.move(t.x,t.y)}move(t,e){let i,s;t instanceof y?(i=t.x,s=t.y):(i=t,s=e);let n=Math.max(Math.abs(i),Math.abs(s)),r=Math.max(1,Math.ceil(n/.25)),a=i/r,l=s/r,c=new Set,d=!1,u=new y(0,0);for(let p=0;p<r;p++){let g=this.gameObject.position.clone();if(this._doMove(a,l),u=u.add(new y(a,l)),this.#t)for(let w of b.instance.colliders){if(w===this.#t||!this.#t.checkCollisionWith(w))continue;let v=w.gameObject;c.add(v);let A=this.#i.has(v),z=this.#t.isTrigger()||w.isTrigger();if(A?(this.#n(this.gameObject,v),v.hasComponent?.(o)||this.#n(v,this.gameObject)):(this.#o(this.gameObject,v),v.hasComponent?.(o)||this.#o(v,this.gameObject)),!z&&!d){this.gameObject.setPosition(g),Math.abs(l)>Math.abs(a)?this.velocity.y*=-this.bounciness:this.velocity.x*=-this.bounciness,d=!0;break}}if(d)break;this.#s(c),this.#i=c}return!0}#s(t){for(let e of this.#i)if(!t.has(e)){let i=e.getComponent(C);i?this.#r(i,2.5)?t.add(e):(this.#e(this.gameObject,e),e?.hasComponent?.(o)||this.#e(e,this.gameObject)):(this.#e(this.gameObject,e),e?.hasComponent?.(o)||this.#e(e,this.gameObject))}}#r(t,e=2){let i=this.#t.getBounds(),s=t.getBounds();return i.x<s.x+s.width+e&&i.x+i.width+e>s.x&&i.y<s.y+s.height+e&&i.y+i.height+e>s.y}#o(t,e){t?.getComponent?.(C)?.isTrigger()?t?.onTriggerEnter?.(e):t?.onCollisionEnter?.(e)}#n(t,e){t?.getComponent?.(C)?.isTrigger()?t?.onTriggerStay?.(e):t?.onCollisionStay?.(e)}#e(t,e){t?.getComponent?.(C)?.isTrigger()?t?.onTriggerExit?.(e):t?.onCollisionExit?.(e)}_doMove(t,e){t instanceof y?this.gameObject.translate(t):this.gameObject.translate(t,e)}};var dt=class extends m{static{h(this,"MovementComponent")}rigidbody;constructor(t=100){super(),this.speed=t}start(){this.rigidbody=this.gameObject.getComponent(H),this.rigidbody||console.warn("MovementComponent requires RigidbodyComponent to function properly.")}update(){let t=new y(0,0);(M.keyboard.isDown("ArrowRight")||M.keyboard.isDown("d")||M.keyboard.isDown("D"))&&(t.x+=this.speed*S.deltaTime),(M.keyboard.isDown("ArrowLeft")||M.keyboard.isDown("a")||M.keyboard.isDown("A"))&&(t.x-=this.speed*S.deltaTime),(M.keyboard.isDown("ArrowDown")||M.keyboard.isDown("s")||M.keyboard.isDown("S"))&&(t.y+=this.speed*S.deltaTime),(M.keyboard.isDown("ArrowUp")||M.keyboard.isDown("w")||M.keyboard.isDown("W"))&&(t.y-=this.speed*S.deltaTime),t.magnitude>0&&this.rigidbody.move(t)}},Ct=class extends dt{static{h(this,"MovementController")}};gt();var xt=class o{static{h(this,"SpriteAsset")}constructor(t,e,i={}){if(t.includes(":"))throw new Error(`SpriteAsset name "${t}" cannot contain colons. Colons are reserved for spritesheet sprite notation (e.g., "sheet:sprite").`);this.name=t,this.imagePath=e,this.image=null,this.isLoaded=!1,this.width=i.width||null,this.height=i.height||null,this.pivotX=i.pivotX||.5,this.pivotY=i.pivotY||.5,this.#t(),this.load()}#t(){k._addSprite(this.name,this)}load(){return new Promise((t,e)=>{this.image=new Image,this.image.onload=()=>{this.isLoaded=!0,this.width||(this.width=this.image.width),this.height||(this.height=this.image.height),t(this)},this.image.onerror=e,this.image.src=this.imagePath})}draw(t,e,i,s,n,r=0,a=1,l=1){if(!this.isLoaded)return;let c=s||this.width,d=n||this.height;t.save(),t.translate(e,i),r!==0&&t.rotate(r),t.scale(a,l);let u=-c*this.pivotX,p=-d*this.pivotY;t.drawImage(this.image,u,p,c,d),t.restore()}getBounds(t,e,i,s){let n=i||this.width,r=s||this.height;return{x:t-n*this.pivotX,y:e-r*this.pivotY,width:n,height:r}}clone(t={}){let e={width:this.width,height:this.height,pivotX:this.pivotX,pivotY:this.pivotY,...t};return new o(this.imagePath,e)}};var St=class{static{h(this,"SpritesheetAsset")}constructor(t,e,i){if(t.includes(":"))throw new Error(`SpritesheetAsset name "${t}" cannot contain colons. Colons are reserved for sprite notation within sheets.`);this.name=t,this.imagePath=e,this.spriteData=i,this.image=null,this.isLoaded=!1,this.sprites=new Map,this.generateSprites(),this._registerSelf(),this.load()}_registerSelf(){k._addSpritesheet(this.name,this),this._registerIndividualSprites()}load(){return new Promise((t,e)=>{this.image=new Image,this.image.onload=()=>{this.isLoaded=!0,this._updateSpriteWrappers(),t(this)},this.image.onerror=e,this.image.src=this.imagePath})}generateSprites(){let{spriteWidth:t,spriteHeight:e,columns:i,rows:s,sprites:n,namedSprites:r}=this.spriteData;if(i!=null&&s!=null&&t!=null&&e!=null)for(let a=0;a<s;a++)for(let l=0;l<i;l++){let d=`sprite_${a*i+l}`,u={x:l*t,y:a*e,width:t,height:e};this.sprites.set(d,u)}n!=null&&Array.isArray(n)&&n.forEach(a=>{if(a.name&&a.startX!=null&&a.startY!=null&&a.endX!=null&&a.endY!=null){let l={x:a.startX,y:a.startY,width:a.endX-a.startX,height:a.endY-a.startY};this.sprites.set(a.name,l)}else console.warn(`Invalid sprite definition in "${this.name}":`,a)}),r!=null&&typeof r=="object"&&!Array.isArray(r)&&Object.entries(r).forEach(([a,l])=>{this.sprites.set(a,l)})}_updateSpriteWrappers(){for(let t of this.sprites.keys()){let e=`${this.name}:${t}`,i=k.getSprite(e);i&&(i.image=this.image,i.isLoaded=this.isLoaded)}}_registerIndividualSprites(){for(let t of this.sprites.keys()){let e=`${this.name}:${t}`;k._addSprite(e,this._createSpriteWrapper(t))}}_createSpriteWrapper(t){let e=this.sprites.get(t);return e?{name:`${this.name}:${t}`,image:this.image,isLoaded:this.isLoaded,width:e.width,height:e.height,pivotX:.5,pivotY:.5,sourceX:e.x,sourceY:e.y,sourceWidth:e.width,sourceHeight:e.height,draw:h((i,s,n,r,a,l=0,c=1,d=1)=>{if(!this.isLoaded||!this.image)return;let u=r||e.width,p=a||e.height;i.save(),i.translate(s,n),l!==0&&i.rotate(l),i.scale(c,d);let g=-u*.5,w=-p*.5;i.drawImage(this.image,e.x,e.y,e.width,e.height,g,w,u,p),i.restore()},"draw"),getBounds:h((i,s,n,r)=>{let a=n||e.width,l=r||e.height;return{x:i-a*.5,y:s-l*.5,width:a,height:l}},"getBounds")}:null}getSprite(t){return this.sprites.get(t)||null}getSpriteNames(){return Array.from(this.sprites.keys())}drawSprite(t,e,i,s,n,r){if(!this.isLoaded)return;let a=this.getSprite(e);if(!a)return;let l=n||a.width,c=r||a.height;t.drawImage(this.image,a.x,a.y,a.width,a.height,i,s,l,c)}};ot();var kt=class extends m{static{h(this,"ImageComponent")}constructor(t,e=null,i=null){super(),this.src=t,this.image=null,this.width=e,this.height=i}static getDefaultMeta(){return{src:"",width:null,height:null}}_applyConstructorArgs(t,e=null,i=null){let s={src:t||"",width:e,height:i};this.applyMeta(s)}_updatePropertiesFromMeta(){this.src=this.__meta.src,this.width=this.__meta.width,this.height=this.__meta.height,this.image&&this.image.src!==this.src&&(this.image=null)}_validateMeta(){let t=this.__meta;if(typeof t.src!="string")throw new Error("src must be a string");if(t.width!==null&&(typeof t.width!="number"||t.width<=0))throw new Error("width must be null or a positive number");if(t.height!==null&&(typeof t.height!="number"||t.height<=0))throw new Error("height must be null or a positive number")}async preload(){return new Promise(t=>{let e=new Image;e.src=this.src,e.onload=()=>{this.image=e,this.width===null&&(this.width=e.width),this.height===null&&(this.height=e.height),t()}})}draw(t){if(this.image){let e=this.gameObject.getGlobalPosition(),i=this.gameObject.getGlobalRotation();t.save(),t.translate(e.x,e.y),i!==0&&t.rotate(i),t.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height),t.restore()}}__internalGizmos(t){if(!this.image)return;let e=this.gameObject.getGlobalPosition(),i=this.gameObject.getGlobalRotation();t.save(),t.translate(e.x,e.y),i!==0&&t.rotate(i),t.strokeStyle="#FF00FF",t.lineWidth=1,t.setLineDash([4,2]),t.strokeRect(-this.width/2,-this.height/2,this.width,this.height),t.setLineDash([]),t.fillStyle="#FF00FF",t.beginPath(),t.arc(0,0,2,0,2*Math.PI),t.fill(),t.fillStyle="#FF00FF",t.font="10px Arial",t.textAlign="center";let s=this.src.split("/").pop();t.fillText(s,0,-this.height/2-8),t.fillText(`${this.width}x${this.height}`,0,this.height/2+15),t.restore()}};var At=class extends m{static{h(this,"ShapeComponent")}constructor(t,e={radius:10,width:10,height:10,color:"white"}){super(),this.__meta=this.constructor.getDefaultMeta(),t||Object.keys(e).length>0?this._applyConstructorArgs(t,e):this._updatePropertiesFromMeta()}static getDefaultMeta(){return{shape:"rectangle",options:{width:10,height:10,color:"white",radius:10,radiusX:10,radiusY:5,x2:10,y2:0,size:20,points:[]}}}_applyConstructorArgs(t,e={}){let i={shape:t||"rectangle",options:{...this.__meta.options,...e}};this.applyMeta(i)}_updatePropertiesFromMeta(){this.shape=this.__meta.shape,this.options={...this.__meta.options}}_validateMeta(){let t=["rectangle","square","circle","ellipse","line","triangle","polygon"];if(!t.includes(this.__meta.shape))throw new Error(`ShapeComponent: Invalid shape type "${this.__meta.shape}". Valid types: ${t.join(", ")}`);if(typeof this.__meta.options.color!="string")throw new Error("ShapeComponent: options.color must be a string");if(["rectangle","square"].includes(this.__meta.shape)&&(this.__meta.options.width<=0||this.__meta.options.height<=0))throw new Error("ShapeComponent: width and height must be greater than 0 for rectangles");if(this.__meta.shape==="circle"&&this.__meta.options.radius<=0)throw new Error("ShapeComponent: radius must be greater than 0 for circles")}get color(){return this.options.color||"black"}set color(t){this.options.color=t}get width(){return this.options.width||10}set width(t){this.options.width=t}get height(){return this.options.height||10}set height(t){this.options.height=t}get radius(){return this.options.radius||10}set radius(t){this.options.radius=t}get radiusX(){return this.options.radiusX||10}set radiusX(t){this.options.radiusX=t}get radiusY(){return this.options.radiusY||5}set radiusY(t){this.options.radiusY=t}get points(){return this.options.points||[]}set points(t){this.options.points=t}get x2(){return this.options.x2||10}set x2(t){this.options.x2=t}get y2(){return this.options.y2||0}set y2(t){this.options.y2=t}get size(){return this.options.size||20}set size(t){this.options.size=t}__draw(t){let e=this.gameObject.getGlobalPosition(),i=this.gameObject.getGlobalRotation();t.save(),i!==0?(t.translate(e.x,e.y),t.rotate(i),this.drawShape(t,0,0)):this.drawShape(t,e.x,e.y),t.restore()}drawShape(t,e,i){switch(this.shape){case"rectangle":case"square":this.drawRect(t,e,i);break;case"circle":this.drawCircle(t,e,i);break;case"ellipse":this.drawEllipse(t,e,i);break;case"line":this.drawLine(t,e,i);break;case"triangle":this.drawTriangle(t,e,i);break;case"polygon":this.drawPolygon(t,e,i);break;default:throw new Error(`ShapeComponent: Unsupported shape type "${this.shape}"`)}}drawRect(t,e,i){let{width:s=10,height:n=10,color:r="black"}=this.options;t.fillStyle=r,t.fillRect(e-s/2,i-n/2,s,n)}drawCircle(t,e,i){let{radius:s=10,color:n="black"}=this.options;t.beginPath(),t.arc(e,i,s,0,Math.PI*2),t.fillStyle=n,t.fill()}drawEllipse(t,e,i){let{radiusX:s=10,radiusY:n=5,color:r="black"}=this.options;t.beginPath(),t.ellipse(e,i,s,n,0,0,Math.PI*2),t.fillStyle=r,t.fill()}drawLine(t,e,i){let{x2:s=e+10,y2:n=i,color:r="black",width:a=2}=this.options;t.strokeStyle=r,t.lineWidth=a,t.beginPath(),t.moveTo(e,i),t.lineTo(s,n),t.stroke()}drawTriangle(t,e,i){let{size:s=20,color:n="black"}=this.options;t.fillStyle=n,t.beginPath(),t.moveTo(e,i),t.lineTo(e+s,i),t.lineTo(e+s/2,i-s),t.closePath(),t.fill()}drawPolygon(t,e,i){let{points:s=[],color:n="black"}=this.options;if(!(s.length<3)){t.fillStyle=n,t.beginPath(),t.moveTo(e+s[0][0],i+s[0][1]);for(let r=1;r<s.length;r++)t.lineTo(e+s[r][0],i+s[r][1]);t.closePath(),t.fill()}}__internalGizmos(t){if(!this.gameObject)return;let e=this.gameObject.getGlobalPosition(),i=this.gameObject.getGlobalRotation();t.save(),t.translate(e.x,e.y),i!==0&&t.rotate(i),t.strokeStyle="#FF00FF",t.lineWidth=1,t.setLineDash([4,2]);let{shape:s,size:n=10,width:r=10,height:a=10}=this.options;switch(s){case"rectangle":t.strokeRect(-r/2,-a/2,r,a);break;case"circle":t.beginPath(),t.arc(0,0,n,0,2*Math.PI),t.stroke();break;case"triangle":let c=n;t.beginPath(),t.moveTo(0,-c/2),t.lineTo(-n/2,c/2),t.lineTo(n/2,c/2),t.closePath(),t.stroke();break;case"polygon":let{points:d=[]}=this.options;if(d.length>=3){t.beginPath(),t.moveTo(d[0][0],d[0][1]);for(let u=1;u<d.length;u++)t.lineTo(d[u][0],d[u][1]);t.closePath(),t.stroke()}break}t.setLineDash([]),t.fillStyle="#FF00FF",t.beginPath(),t.arc(0,0,2,0,2*Math.PI),t.fill(),t.fillStyle="#FF00FF",t.font="10px Arial",t.textAlign="center",t.fillText(`Shape: ${s||"none"}`,0,-Math.max(n,a)/2-8);let l="";switch(s){case"rectangle":l=`${r}x${a}`;break;case"circle":l=`r:${n}`;break;case"triangle":l=`s:${n}`;break;case"polygon":l=`${this.options.points?.length||0} pts`;break}l&&t.fillText(l,0,Math.max(n,a)/2+15),t.restore()}};lt();at();var Dt=class extends m{static{h(this,"TilemapComponent")}constructor(t={}){super(),this.tileSize=t.tileSize||32,this.tileWidth=t.tileWidth||this.tileSize,this.tileHeight=t.tileHeight||this.tileSize,this.tiles=t.tiles||{},this.grid=t.grid||[],this.zIndex=t.zIndex||0,this.sortingLayer=t.sortingLayer||"Default",this.enableCollision=t.enableCollision!==!1,this.resolvedTiles=new Map,this.resolvedSprites=new Map,this.colliders=[],this.gridWidth=this.grid.length>0?this.grid[0].length:0,this.gridHeight=this.grid.length}start(){this.resolveTiles(),this.createColliders()}resolveTiles(){this.resolvedTiles.clear(),this.resolvedSprites.clear();for(let[t,e]of Object.entries(this.tiles)){if(e==null){this.resolvedTiles.set(t,null);continue}let i=null;if(typeof e=="string"){if(i=I.getTile(e),!i){console.warn(`TilemapComponent: Tile "${e}" not found in TileRegistry`);continue}}else if(e instanceof R)i=e;else{console.warn(`TilemapComponent: Invalid tile reference for id "${t}":`,e);continue}this.resolvedTiles.set(t,i);let s=k.getSprite(i.spriteName);s?this.resolvedSprites.set(t,s):console.warn(`TilemapComponent: Sprite "${i.spriteName}" not found for tile "${i.name}"`)}}createColliders(){if(this.enableCollision){this.clearColliders();for(let t=0;t<this.grid.length;t++)for(let e=0;e<this.grid[t].length;e++){let i=this.grid[t][e],s=this.resolvedTiles.get(String(i));s&&s.hasCollision()&&this.createTileCollider(s,e,t)}}}createTileCollider(t,e,i){let s=this.gameObject.x+e*this.tileWidth,n=this.gameObject.y+i*this.tileHeight,r={x:s,y:n,width:t.collider.width||this.tileWidth,height:t.collider.height||this.tileHeight,radius:t.collider.radius,type:t.collider.type||"box",trigger:t.collider.trigger||!1,tile:t,gridX:e,gridY:i};this.colliders.push(r)}clearColliders(){this.colliders=[]}__draw(t){t.save(),t.translate(this.gameObject.x,this.gameObject.y);for(let e=0;e<this.grid.length;e++)for(let i=0;i<this.grid[e].length;i++)this.renderTile(t,i,e);t.restore()}draw(t){}renderTile(t,e,i){let s=this.grid[i][e],n=this.resolvedTiles.get(String(s)),r=this.resolvedSprites.get(String(s));if(!n||!r)return;let a=e*this.tileWidth,l=i*this.tileHeight;t.save(),n.opacity!==1&&(t.globalAlpha=n.opacity),n.color!=="#FFFFFF"&&(t.fillStyle=n.color,t.globalCompositeOperation="multiply"),n.flipX||n.flipY?(t.translate(a+this.tileWidth/2,l+this.tileHeight/2),t.scale(n.flipX?-1:1,n.flipY?-1:1),t.translate(-this.tileWidth/2,-this.tileHeight/2)):t.translate(a,l);let c=n.width||this.tileWidth,d=n.height||this.tileHeight;r.image&&r.image.complete&&r.draw(t,c/2,d/2,c,d,0),t.restore()}getTileAt(t,e){if(e<0||e>=this.grid.length||t<0||t>=this.grid[e].length)return null;let i=this.grid[e][t];return this.resolvedTiles.get(String(i))||null}setTileAt(t,e,i){e<0||e>=this.grid.length||t<0||t>=this.grid[e].length||(this.grid[e][t]=i,this.enableCollision&&this.createColliders())}worldToGrid(t,e){let i=t-this.gameObject.x,s=e-this.gameObject.y;return{col:Math.floor(i/this.tileWidth),row:Math.floor(s/this.tileHeight)}}gridToWorld(t,e){return{x:this.gameObject.x+t*this.tileWidth,y:this.gameObject.y+e*this.tileHeight}}getTilesWhere(t){let e=[];for(let i=0;i<this.grid.length;i++)for(let s=0;s<this.grid[i].length;s++){let n=this.getTileAt(s,i);n&&t(n,s,i)&&e.push({tile:n,col:s,row:i})}return e}update(t){}destroy(){this.clearColliders(),this.resolvedTiles.clear(),this.resolvedSprites.clear(),super.destroy()}};var Z=class o extends C{static{h(this,"CircleColliderComponent")}constructor(t=null,e=!1){super(),this.radius=t,this.trigger=e}static getDefaultMeta(){return{radius:null,trigger:!1}}_applyConstructorArgs(t=null,e=!1){let i={radius:t,trigger:e};this.applyMeta(i)}_updatePropertiesFromMeta(){this.radius=this.__meta.radius,this.trigger=this.__meta.trigger}_validateMeta(){let t=this.__meta;if(t.radius!==null&&(typeof t.radius!="number"||t.radius<=0))throw new Error("radius must be null or a positive number");if(typeof t.trigger!="boolean")throw new Error("trigger must be a boolean")}checkCollisionWith(t){if(t instanceof o){let e=this.getBounds(),i=t.getBounds(),s=e.x-i.x,n=e.y-i.y;return Math.hypot(s,n)<e.radius+i.radius}else return this.circleBoxCollision(t)}circleBoxCollision(t){let e=this.getBounds(),i=t.getBounds(),s=Math.max(i.x,Math.min(e.x,i.x+i.width)),n=Math.max(i.y,Math.min(e.y,i.y+i.height)),r=e.x-s,a=e.y-n;return r*r+a*a<e.radius*e.radius}getBounds(){let t=this.gameObject.getGlobalPosition(),e=this.radius;return{x:t.x,y:t.y,radius:e}}__internalGizmos(t){let e=this.getBounds();t.save(),t.strokeStyle=this.trigger?"#00ffddff":"#00FF00",t.lineWidth=1,t.setLineDash([2,2]),t.beginPath(),t.arc(e.x,e.y,e.radius,0,Math.PI*2),t.stroke();let i=3;t.setLineDash([]),t.beginPath(),t.moveTo(e.x-i,e.y),t.lineTo(e.x+i,e.y),t.moveTo(e.x,e.y-i),t.lineTo(e.x,e.y+i),t.stroke(),t.restore()}};var Tt=class o extends C{static{h(this,"BoxColliderComponent")}constructor(t=null,e=null,i=!1){super(),this.width=t,this.height=e,this.trigger=i}static getDefaultMeta(){return{width:null,height:null,trigger:!1}}_applyConstructorArgs(t=null,e=null,i=!1){let s={width:t,height:e,trigger:i};this.applyMeta(s)}_updatePropertiesFromMeta(){this.width=this.__meta.width,this.height=this.__meta.height,this.trigger=this.__meta.trigger}_validateMeta(){let t=this.__meta;if(t.width!==null&&(typeof t.width!="number"||t.width<=0))throw new Error("width must be null or a positive number");if(t.height!==null&&(typeof t.height!="number"||t.height<=0))throw new Error("height must be null or a positive number");if(typeof t.trigger!="boolean")throw new Error("trigger must be a boolean")}checkCollisionWith(t){return t instanceof o?this.checkBoxBoxCollision(t):t instanceof Z?t.checkCollisionWith(this):!1}checkBoxBoxCollision(t){let e=this.getBounds(),i=t.getBounds(),s=.01;return e.x<i.x+i.width+s&&e.x+e.width+s>i.x&&e.y<i.y+i.height+s&&e.y+e.height+s>i.y}getBounds(){let t=this.gameObject.getGlobalPosition(),e=this.width,i=this.height;return{x:t.x-e/2,y:t.y-i/2,width:e,height:i}}__internalGizmos(t){let e=this.getBounds();t.save(),t.strokeStyle=this.trigger?"#00ffddff":"#00FF00",t.lineWidth=1,t.setLineDash([2,2]),t.strokeRect(e.x,e.y,e.width,e.height);let i=e.x+e.width/2,s=e.y+e.height/2,n=3;t.setLineDash([]),t.beginPath(),t.moveTo(i-n,s),t.lineTo(i+n,s),t.moveTo(i,s-n),t.lineTo(i,s+n),t.stroke(),t.restore()}};var Lt=class{static{h(this,"Random")}static range(t,e){return Math.floor(Math.random()*(e-t+1)+t)}};var Ft=class o{static{h(this,"Vector3")}constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}static get zero(){return new o(0,0,0)}static get one(){return new o(1,1,1)}static get up(){return new o(0,1,0)}static get down(){return new o(0,-1,0)}static get left(){return new o(-1,0,0)}static get right(){return new o(1,0,0)}static get forward(){return new o(0,0,1)}static get back(){return new o(0,0,-1)}static get positiveInfinity(){return new o(1/0,1/0,1/0)}static get negativeInfinity(){return new o(-1/0,-1/0,-1/0)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}get sqrMagnitude(){return this.x*this.x+this.y*this.y+this.z*this.z}get normalized(){let t=this.magnitude;return t===0?o.zero:new o(this.x/t,this.y/t,this.z/t)}add(t){return new o(this.x+t.x,this.y+t.y,this.z+t.z)}subtract(t){return new o(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(t){return new o(this.x*t,this.y*t,this.z*t)}divide(t){if(t===0)throw new Error("Cannot divide by zero");return new o(this.x/t,this.y/t,this.z/t)}normalize(){let t=this.magnitude;return t===0?(this.x=0,this.y=0,this.z=0):(this.x/=t,this.y/=t,this.z/=t),this}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}clone(){return new o(this.x,this.y,this.z)}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}toString(){return`(${this.x.toFixed(2)}, ${this.y.toFixed(2)}, ${this.z.toFixed(2)})`}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){return new o(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static distance(t,e){let i=t.x-e.x,s=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+s*s+n*n)}static sqrDistance(t,e){let i=t.x-e.x,s=t.y-e.y,n=t.z-e.z;return i*i+s*s+n*n}static lerp(t,e,i){return i=Math.max(0,Math.min(1,i)),new o(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i,t.z+(e.z-t.z)*i)}static lerpUnclamped(t,e,i){return new o(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i,t.z+(e.z-t.z)*i)}static slerp(t,e,i){i=Math.max(0,Math.min(1,i));let s=o.dot(t.normalized,e.normalized),n=Math.max(-1,Math.min(1,s));if(Math.abs(n)>.9995)return o.lerp(t,e,i);let r=Math.acos(Math.abs(n)),a=Math.sin(r),l=Math.sin((1-i)*r)/a,c=Math.sin(i*r)/a;return n<0?new o(l*t.x-c*e.x,l*t.y-c*e.y,l*t.z-c*e.z):new o(l*t.x+c*e.x,l*t.y+c*e.y,l*t.z+c*e.z)}static min(t,e){return new o(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))}static max(t,e){return new o(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))}static moveTowards(t,e,i){let s=e.subtract(t),n=s.magnitude;return n<=i||n===0?e.clone():t.add(s.divide(n).multiply(i))}static reflect(t,e){let i=-2*o.dot(e,t);return new o(i*e.x+t.x,i*e.y+t.y,i*e.z+t.z)}static angle(t,e){let i=Math.sqrt(t.sqrMagnitude*e.sqrMagnitude);if(i<1e-15)return 0;let s=Math.max(-1,Math.min(1,o.dot(t,e)/i));return Math.acos(s)}static project(t,e){let i=e.sqrMagnitude;if(i<1e-15)return o.zero;let s=o.dot(t,e);return e.multiply(s/i)}static projectOnPlane(t,e){let i=e.sqrMagnitude;if(i<1e-15)return t.clone();let s=o.dot(t,e);return t.subtract(e.multiply(s/i))}static clampMagnitude(t,e){let i=t.sqrMagnitude;if(i>e*e){let s=Math.sqrt(i),n=t.x/s,r=t.y/s,a=t.z/s;return new o(n*e,r*e,a*e)}return t.clone()}static rotateTowards(t,e,i,s){let n=t.magnitude,r=e.magnitude;if(n>1e-15&&r>1e-15){let l=t.divide(n),c=e.divide(r),d=o.angle(l,c);if(d>1e-15){let u=Math.min(1,i/d),p=o.slerp(l,c,u),g=n+Math.max(-s,Math.min(s,r-n));return p.multiply(g)}}let a=n+Math.max(-s,Math.min(s,r-n));return e.normalized.multiply(a)}static smoothDamp(t,e,i,s,n=1/0,r){s=Math.max(1e-4,s);let a=2/s,l=a*r,c=1/(1+l+.48*l*l+.235*l*l*l),d=t.x-e.x,u=t.y-e.y,p=t.z-e.z,g=e.clone(),w=n*s,v=w*w,A=d*d+u*u+p*p;if(A>v){let ut=Math.sqrt(A);d=d/ut*w,u=u/ut*w,p=p/ut*w}let z=t.x-d,V=t.y-u,Q=t.z-p,B=(i.x+a*d)*r,_=(i.y+a*u)*r,J=(i.z+a*p)*r;i.x=(i.x-a*B)*c,i.y=(i.y-a*_)*c,i.z=(i.z-a*J)*c;let $=z+(d+B)*c,O=V+(u+_)*c,N=Q+(p+J)*c,tt=g.x-t.x,qt=g.y-t.y,jt=g.z-t.z,Ut=$-g.x,Xt=O-g.y,Yt=N-g.z;return tt*Ut+qt*Xt+jt*Yt>0&&($=g.x,O=g.y,N=g.z,i.x=($-g.x)/r,i.y=(O-g.y)/r,i.z=(N-g.z)/r),new o($,O,N)}static orthonormalize(t){let e=t.normalized,i;Math.abs(e.x)<.9?i=o.cross(e,o.right).normalized:i=o.cross(e,o.up).normalized;let s=o.cross(e,i).normalized;return{normal:e,tangent:i,binormal:s}}};var Pt=class extends m{static{h(this,"FollowTarget")}constructor(t){super(),this.target=t}update(){this.target&&(this.target instanceof y?this.gameObject.setPosition(this.target):this.target.position?this.gameObject.setPosition(this.target.position):this.gameObject.setPosition(this.target.x,this.target.y))}};pt();var T=class o extends m{static{h(this,"AudioListenerComponent")}constructor(){super(),this.masterVolume=1,this.dopplerFactor=1,this.rolloffFactor=1,this.isActive=!1,o.main||this.setAsMainListener(),console.log(`\u{1F3A7} AudioListener created ${this.isActive?"(ACTIVE)":"(inactive)"}`)}setAsMainListener(){o.main&&o.main!==this&&(o.main.isActive=!1,console.log("\u{1F3A7} Previous AudioListener deactivated")),o.main=this,this.isActive=!0,console.log("\u{1F3A7} AudioListener activated as main listener")}calculate3DAudio(t,e=500,i="linear"){if(!this.isActive||!this.gameObject)return{volume:0,pan:0,distance:1/0};let s=this.gameObject.position,n=t.x-s.x,r=t.y-s.y,a=Math.sqrt(n*n+r*r),l=1;if(a>0&&e>0)switch(i){case"linear":l=Math.max(0,1-a/e);break;case"logarithmic":l=Math.max(0,1/(1+a/e));break;case"inverse":l=Math.max(0,e/(e+a));break;default:l=Math.max(0,1-a/e)}l*=this.rolloffFactor*this.masterVolume;let c=0;if(a>0){let d=e*.5;c=Math.max(-1,Math.min(1,n/d))}return{volume:Math.max(0,Math.min(1,l)),pan:Math.max(-1,Math.min(1,c)),distance:a}}setMasterVolume(t){this.masterVolume=Math.max(0,Math.min(1,t)),console.log(`\u{1F50A} Master volume set to ${(this.masterVolume*100).toFixed(0)}%`)}get position(){return this.gameObject?this.gameObject.position:null}destroy(){o.main===this&&(o.main=null,console.log("\u{1F3A7} Main AudioListener removed")),super.destroy()}static getDefaultMeta(){return{masterVolume:1,dopplerFactor:1,rolloffFactor:1}}_updatePropertiesFromMeta(){this.masterVolume=this.__meta.masterVolume,this.dopplerFactor=this.__meta.dopplerFactor,this.rolloffFactor=this.__meta.rolloffFactor}_validateMeta(){if(typeof this.__meta.masterVolume!="number"||this.__meta.masterVolume<0||this.__meta.masterVolume>1)throw new Error("AudioListener masterVolume must be a number between 0 and 1");if(typeof this.__meta.dopplerFactor!="number"||this.__meta.dopplerFactor<0)throw new Error("AudioListener dopplerFactor must be a non-negative number");if(typeof this.__meta.rolloffFactor!="number"||this.__meta.rolloffFactor<0)throw new Error("AudioListener rolloffFactor must be a non-negative number")}};T.main=null;nt();var zt=class extends m{static{h(this,"AudioSourceComponent")}constructor(t=null,e={}){super(),this.__meta=this.constructor.getDefaultMeta(),t||Object.keys(e).length>0?this._applyConstructorArgs(t,e):this._updatePropertiesFromMeta(),this.isPlaying=!1,this.isPaused=!1,this.currentTime=0,this.sourceNode=null,this.gainNode=null,this.pannerNode=null,this.audioContext=null,this.startTime=0,this.pauseTime=0,console.log(`\u{1F50A} AudioSource created (${this.spatial?"3D":"2D"} audio)`)}static getDefaultMeta(){return{clip:null,spatial:!0,autoPlay:!1,loop:!1,volume:1,pitch:1,maxDistance:500,minDistance:1,rolloffMode:"linear"}}_applyConstructorArgs(t,e={}){let i={...this.__meta,clip:t,...e};this.applyMeta(i)}_updatePropertiesFromMeta(){this._setClip(this.__meta.clip),this.spatial=this.__meta.spatial,this.autoPlay=this.__meta.autoPlay,this.loop=this.__meta.loop,this.volume=this.__meta.volume,this.pitch=this.__meta.pitch,this.maxDistance=this.__meta.maxDistance,this.minDistance=this.__meta.minDistance,this.rolloffMode=this.__meta.rolloffMode,this.autoPlay&&this.clip&&this.clip.isReady&&this.play()}_validateMeta(){if(this.__meta.volume<0||this.__meta.volume>1)throw new Error("AudioSource volume must be between 0 and 1");if(this.__meta.pitch<.1||this.__meta.pitch>3)throw new Error("AudioSource pitch must be between 0.1 and 3");if(this.__meta.maxDistance<=0)throw new Error("AudioSource maxDistance must be positive");let t=["linear","logarithmic","inverse"];if(!t.includes(this.__meta.rolloffMode))throw new Error(`AudioSource rolloffMode must be one of: ${t.join(", ")}`)}_setClip(t){if(!t){this.clip=null;return}if(typeof t=="string"){let e=L.getAudio(t);e?(this.clip=e,this.clipName=t):(console.warn(`AudioSourceComponent: Audio "${t}" not found in AudioRegistry`),this.clip=null,this.clipName=null)}else this.clip=t,this.clipName=t.name||"unknown"}setClip(t){this._setClip(t),this.__meta.clip=t}getClipName(){return this.clipName||(this.clip?this.clip.name:null)}play(t=0){if(!this.clip||!this.clip.isReady)return console.warn("Cannot play: AudioClip not loaded or not assigned"),!1;this.stop();try{if(this.audioContext=this.clip.audioContext,this.sourceNode=this.clip.createSourceNode(),!this.sourceNode)return console.error("Failed to create audio source node"),!1;this.sourceNode.loop=this.loop,this.sourceNode.playbackRate.value=this.pitch,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=this.volume,this.sourceNode.connect(this.gainNode),this.spatial&&this.gameObject?this._setup3DAudio():this.gainNode.connect(this.audioContext.destination),this.sourceNode.onended=()=>{this.loop||(this.isPlaying=!1,this.currentTime=0,this._cleanup())};let e=this.audioContext.currentTime+t,i=this.isPaused?this.pauseTime:0;return this.sourceNode.start(e,i),this.isPlaying=!0,this.isPaused=!1,this.startTime=e-i,console.log(`\u{1F3B5} Audio started: ${this.clip.name} (${this.spatial?"3D":"2D"})`),!0}catch(e){return console.error("Failed to play audio:",e),this._cleanup(),!1}}pause(){if(this.isPlaying){if(this.pauseTime=this.audioContext.currentTime-this.startTime,this.sourceNode)try{this.sourceNode.stop()}catch{}this.isPlaying=!1,this.isPaused=!0,this._cleanup(),console.log(`\u23F8\uFE0F Audio paused: ${this.clip?this.clip.name:"unknown"}`)}}stop(){if(!(!this.isPlaying&&!this.isPaused)){if(this.sourceNode)try{this.sourceNode.stop()}catch{}this.isPlaying=!1,this.isPaused=!1,this.currentTime=0,this.pauseTime=0,this._cleanup(),console.log(`\u23F9\uFE0F Audio stopped: ${this.clip?this.clip.name:"unknown"}`)}}_setup3DAudio(){if(!this.spatial||!this.gameObject||!T.main){this.gainNode.connect(this.audioContext.destination);return}let e=T.main.calculate3DAudio(this.gameObject.position,this.maxDistance,this.rolloffMode);this.pannerNode=this.audioContext.createStereoPanner(),this.pannerNode.pan.value=e.pan,this.gainNode.gain.value=this.volume*e.volume,this.gainNode.connect(this.pannerNode),this.pannerNode.connect(this.audioContext.destination),console.log(`\u{1F3AF} 3D Audio: vol=${e.volume.toFixed(2)}, pan=${e.pan.toFixed(2)}, dist=${e.distance.toFixed(1)}`)}update(){if(this.isPlaying&&this.spatial&&this.pannerNode&&this.gameObject&&T.main){let e=T.main.calculate3DAudio(this.gameObject.position,this.maxDistance,this.rolloffMode);this.gainNode.gain.value=this.volume*e.volume,this.pannerNode.pan.value=e.pan}this.isPlaying&&this.audioContext&&(this.currentTime=this.audioContext.currentTime-this.startTime)}_cleanup(){this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.pannerNode&&(this.pannerNode.disconnect(),this.pannerNode=null)}setVolume(t){if(this.volume=Math.max(0,Math.min(1,t)),this.gainNode)if(this.spatial&&this.gameObject&&T.main){let i=T.main.calculate3DAudio(this.gameObject.position,this.maxDistance,this.rolloffMode);this.gainNode.gain.value=this.volume*i.volume}else this.gainNode.gain.value=this.volume}setPitch(t){this.pitch=Math.max(.1,Math.min(3,t)),this.sourceNode&&(this.sourceNode.playbackRate.value=this.pitch)}get time(){return this.currentTime}set time(t){if(this.clip&&t>=0&&t<=this.clip.length){let e=this.isPlaying;this.stop(),this.pauseTime=t,this.isPaused=!0,e&&this.play()}}destroy(){this.stop(),super.destroy()}};var x=class o{static{h(this,"ProceduralAudioClip")}constructor(t,e={}){this.name=t,this.options={type:"tone",frequency:440,duration:1,volume:.5,sampleRate:44100,fadeIn:.01,fadeOut:.1,...e},this.audioBuffer=null,this.audioContext=null,this._isLoaded=!1}async load(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioBuffer=await this.generateAudio(),this._isLoaded=!0,console.log(`ProceduralAudioClip "${this.name}" generated successfully`)}catch(t){throw console.error(`Failed to generate ProceduralAudioClip "${this.name}":`,t),t}}async generateAudio(){let{duration:t,sampleRate:e}=this.options,i=Math.floor(t*e),s=this.audioContext.createBuffer(1,i,e),n=s.getChannelData(0);switch(this.options.type){case"tone":this.generateTone(n,i);break;case"noise":this.generateNoise(n,i);break;case"sweep":this.generateSweep(n,i);break;case"complex":this.generateComplex(n,i);break;case"random":this.generateRandom(n,i);break;default:this.generateTone(n,i)}return this.applyEnvelope(n,i),s}generateTone(t,e){let{frequency:i,sampleRate:s}=this.options,n=this.options.waveType||"sine";for(let r=0;r<e;r++){let a=r/s*i*2*Math.PI;switch(n){case"sine":t[r]=Math.sin(a);break;case"square":t[r]=Math.sin(a)>0?1:-1;break;case"sawtooth":t[r]=2*(a/(2*Math.PI)-Math.floor(a/(2*Math.PI)+.5));break;case"triangle":t[r]=2*Math.abs(2*(a/(2*Math.PI)-Math.floor(a/(2*Math.PI)+.5)))-1;break;default:t[r]=Math.sin(a)}}}generateNoise(t,e){switch(this.options.noiseType||"white"){case"white":for(let s=0;s<e;s++)t[s]=Math.random()*2-1;break;case"pink":this.generatePinkNoise(t,e);break;case"brown":this.generateBrownNoise(t,e);break}}generatePinkNoise(t,e){let i=0,s=0,n=0,r=0,a=0,l=0,c=0;for(let d=0;d<e;d++){let u=Math.random()*2-1;i=.99886*i+u*.0555179,s=.99332*s+u*.0750759,n=.969*n+u*.153852,r=.8665*r+u*.3104856,a=.55*a+u*.5329522,l=-.7616*l-u*.016898,t[d]=i+s+n+r+a+l+c+u*.5362,t[d]*=.11,c=u*.115926}}generateBrownNoise(t,e){let i=0;for(let s=0;s<e;s++){let n=Math.random()*2-1;t[s]=(i+.02*n)/1.02,i=t[s],t[s]*=3.5}}generateSweep(t,e){let i=this.options.startFreq||this.options.frequency,s=this.options.endFreq||this.options.frequency*2,{sampleRate:n}=this.options;for(let r=0;r<e;r++){let a=r/e,l=i+(s-i)*a,c=r/n*l*2*Math.PI;t[r]=Math.sin(c)}}generateComplex(t,e){let{frequency:i,sampleRate:s}=this.options,n=this.options.harmonics||[1,.5,.25,.125];for(let r=0;r<e;r++){let a=0;for(let l=0;l<n.length;l++){let c=i*(l+1),d=r/s*c*2*Math.PI;a+=Math.sin(d)*n[l]}t[r]=a/n.length}}generateRandom(t,e){let i=["tone","noise","sweep"],s=i[Math.floor(Math.random()*i.length)],n={...this.options};switch(this.options.frequency=100+Math.random()*800,this.options.waveType=["sine","square","sawtooth","triangle"][Math.floor(Math.random()*4)],this.options.noiseType=["white","pink","brown"][Math.floor(Math.random()*3)],s){case"tone":this.generateTone(t,e);break;case"noise":this.generateNoise(t,e);break;case"sweep":this.options.startFreq=50+Math.random()*200,this.options.endFreq=200+Math.random()*800,this.generateSweep(t,e);break}this.options=n}applyEnvelope(t,e){let{volume:i,fadeIn:s,fadeOut:n,sampleRate:r}=this.options,a=Math.floor(s*r),l=Math.floor(n*r);for(let c=0;c<e;c++){let d=i;c<a&&(d*=c/a),c>e-l&&(d*=(e-c)/l),t[c]*=d}}isLoaded(){return this._isLoaded&&this.audioBuffer!==null}static meta(t){let i={...o.getDefaultMeta(),...t};if(!i.name||i.name.trim()==="")throw new Error("ProceduralAudioClip metadata must include a valid name");return new o(i.name,i)}static getDefaultMeta(){return{name:"",type:"tone",frequency:440,duration:1,volume:.5,sampleRate:44100,fadeIn:.01,fadeOut:.1,waveType:"sine",noiseType:"white",startFreq:null,endFreq:null,harmonics:[1,.5,.25,.125]}}applyMeta(t){Object.assign(this.options,t),t.name&&(this.name=t.name),this._isLoaded&&(this._isLoaded=!1,this.audioBuffer=null)}toMeta(){return{name:this.name,...this.options}}downloadAsWAV(t=null){if(!this.isLoaded()){console.error("Cannot download audio: ProceduralAudioClip not loaded");return}let e=t||`${this.name}.wav`,i=this.audioBufferToWAV(this.audioBuffer);this.downloadBlob(i,e)}audioBufferToWAV(t){let e=t.length,i=t.numberOfChannels,s=t.sampleRate,r=i*2,a=s*r,l=e*r,c=44+l,d=new ArrayBuffer(c),u=new DataView(d),p=h((w,v)=>{for(let A=0;A<v.length;A++)u.setUint8(w+A,v.charCodeAt(A))},"writeString");p(0,"RIFF"),u.setUint32(4,c-8,!0),p(8,"WAVE"),p(12,"fmt "),u.setUint32(16,16,!0),u.setUint16(20,1,!0),u.setUint16(22,i,!0),u.setUint32(24,s,!0),u.setUint32(28,a,!0),u.setUint16(32,r,!0),u.setUint16(34,16,!0),p(36,"data"),u.setUint32(40,l,!0);let g=44;for(let w=0;w<e;w++)for(let v=0;v<i;v++){let A=t.getChannelData(v)[w],z=Math.max(-1,Math.min(1,A));u.setInt16(g,z*32767,!0),g+=2}return new Blob([d],{type:"audio/wav"})}downloadBlob(t,e){let i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=e,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),setTimeout(()=>URL.revokeObjectURL(i),100),console.log(`\u{1F4E5} Downloaded: ${e}`)}getWAVBlob(){return this.isLoaded()?this.audioBufferToWAV(this.audioBuffer):null}async getAsBase64WAV(){if(!this.isLoaded())throw new Error("Audio must be loaded before converting to Base64");let t=this.audioBufferToWAV(this.audioBuffer);return new Promise((e,i)=>{let s=new FileReader;s.onload=()=>e(s.result.split(",")[1]),s.onerror=i,s.readAsDataURL(t)})}static createBeep(t=800,e=.2){return o.meta({name:`beep_${t}`,type:"tone",frequency:t,duration:e,waveType:"sine",volume:.3})}static createClick(t=.1){return o.meta({name:"click",type:"noise",duration:t,noiseType:"white",volume:.2,fadeOut:t*.8})}static createWhoosh(t=.5){return o.meta({name:"whoosh",type:"sweep",startFreq:1e3,endFreq:200,duration:t,volume:.4})}static createZap(t=.3){return o.meta({name:"zap",type:"complex",frequency:300,duration:t,harmonics:[1,.8,.6,.4,.2],volume:.5})}static createRandomSFX(t=.5){return o.meta({name:`random_sfx_${Date.now()}`,type:"random",duration:t,volume:.4})}};var Bt=class{static{h(this,"RandomAudioGenerator")}static generateBeep(t={}){let e=t.frequency||800,i=t.duration||.3,s=t.volume||.5;return new x(`beep_${Date.now()}`,{type:"tone",frequency:e,duration:i,waveType:"sine",volume:s,fadeIn:.01,fadeOut:.05})}static generateTone(t={}){let e=t.frequency||440,i=t.duration||1,s=t.volume||.4,n=t.waveType||"sine";return new x(`tone_${Date.now()}`,{type:"tone",frequency:e,duration:i,waveType:n,volume:s,fadeIn:.05,fadeOut:.1})}static generateNoise(t={}){let e=t.duration||.5,i=t.volume||.3,s=t.type||"white";return new x(`noise_${Date.now()}`,{type:"noise",noiseType:s,duration:e,volume:i,fadeIn:.02,fadeOut:.1})}static generateChirp(t={}){let e=t.startFreq||200,i=t.endFreq||800,s=t.duration||1,n=t.volume||.5;return new x(`chirp_${Date.now()}`,{type:"sweep",startFreq:e,endFreq:i,duration:s,volume:n,fadeIn:.02,fadeOut:.1})}static generateRandom(t={}){let e=t.duration||.5+Math.random()*1.5,i=t.volume||.3+Math.random()*.4,s=["tone","noise","sweep"];switch(s[Math.floor(Math.random()*s.length)]){case"tone":return this.generateTone({frequency:200+Math.random()*600,duration:e,volume:i,waveType:["sine","square","triangle","sawtooth"][Math.floor(Math.random()*4)]});case"noise":return this.generateNoise({duration:e,volume:i,type:["white","pink"][Math.floor(Math.random()*2)]});case"sweep":return this.generateChirp({startFreq:100+Math.random()*400,endFreq:400+Math.random()*800,duration:e,volume:i});default:return this.generateBeep({duration:e,volume:i})}}static randomBeep(t={}){let e=t.frequency||200+Math.random()*600,i=t.duration||.1+Math.random()*.3,s=t.waveType||["sine","square","triangle"][Math.floor(Math.random()*3)];return new x(`random_beep_${Date.now()}`,{type:"tone",frequency:e,duration:i,waveType:s,volume:.3+Math.random()*.3,fadeIn:.01,fadeOut:i*.3})}static randomAmbient(t={}){let e=["white","pink","brown"],i=t.noiseType||e[Math.floor(Math.random()*e.length)],s=t.duration||2+Math.random()*8;return new x(`random_ambient_${Date.now()}`,{type:"noise",noiseType:i,duration:s,volume:.1+Math.random()*.2,fadeIn:s*.1,fadeOut:s*.1})}static randomSweep(t={}){let e=t.startFreq||100+Math.random()*500,i=t.endFreq||200+Math.random()*800,s=t.duration||.3+Math.random()*.7,n=Math.random()>.5,r=n?i:e,a=n?e:i;return new x(`random_sweep_${Date.now()}`,{type:"sweep",startFreq:r,endFreq:a,duration:s,volume:.2+Math.random()*.3})}static randomHarmonic(t={}){let e=t.frequency||150+Math.random()*400,i=t.duration||.5+Math.random()*1.5,s=[],n=3+Math.floor(Math.random()*5);for(let r=0;r<n;r++)s.push(Math.random()*(1/(r+1)));return new x(`random_harmonic_${Date.now()}`,{type:"complex",frequency:e,duration:i,harmonics:s,volume:.3+Math.random()*.2})}static randomPercussion(t={}){let e=t.duration||.05+Math.random()*.15,i=["noise","tone"],s=i[Math.floor(Math.random()*i.length)],n={duration:e,volume:.4+Math.random()*.4,fadeIn:.001,fadeOut:e*.7};return s==="noise"?new x(`random_percussion_${Date.now()}`,{...n,type:"noise",noiseType:"white"}):new x(`random_percussion_${Date.now()}`,{...n,type:"tone",frequency:80+Math.random()*200,waveType:"square"})}static randomNote(t={}){let e=[261.63,277.18,293.66,311.13,329.63,349.23,369.99,392,415.3,440,466.16,493.88,523.25,554.37,587.33,622.25,659.25,698.46,739.99,783.99,830.61,880,932.33,987.77],i=t.frequency||e[Math.floor(Math.random()*e.length)],s=t.duration||.5+Math.random()*1,n=t.waveType||["sine","triangle"][Math.floor(Math.random()*2)];return new x(`random_note_${Date.now()}`,{type:"tone",frequency:i,duration:s,waveType:n,volume:.3+Math.random()*.3,fadeIn:.05,fadeOut:s*.2})}static randomLaser(t={}){let e=t.startFreq||400+Math.random()*600,i=t.endFreq||50+Math.random()*200,s=t.duration||.2+Math.random()*.3;return new x(`random_laser_${Date.now()}`,{type:"sweep",startFreq:e,endFreq:i,duration:s,volume:.4+Math.random()*.3,fadeOut:s*.5})}static randomPickup(t={}){return new x(`random_pickup_${Date.now()}`,{type:"complex",frequency:600+Math.random()*400,duration:.3+Math.random()*.2,harmonics:[1,.6,.3,.1],volume:.4+Math.random()*.2,fadeOut:.15})}static randomExplosion(t={}){let e=t.duration||.5+Math.random()*1;return new x(`random_explosion_${Date.now()}`,{type:"noise",noiseType:"brown",duration:e,volume:.5+Math.random()*.3,fadeIn:.01,fadeOut:e*.6})}static randomAny(t={}){let e=[this.randomBeep,this.randomSweep,this.randomHarmonic,this.randomPercussion,this.randomNote,this.randomLaser,this.randomPickup];return e[Math.floor(Math.random()*e.length)].call(this,t)}static randomSequence(t=5,e={}){let i=[];for(let s=0;s<t;s++)i.push(this.randomAny(e));return i}static createVariations(t,e=3,i={}){let s=[],n=`random${t.charAt(0).toUpperCase()+t.slice(1)}`;if(typeof this[n]=="function")for(let r=0;r<e;r++)s.push(this[n](i));else{console.warn(`Unknown sound type: ${t}`);for(let r=0;r<e;r++)s.push(this.randomAny(i))}return s}static async generateAndDownload(t,e={},i){let s;switch(t){case"beep":s=this.randomBeep(e);break;case"sweep":s=this.randomSweep(e);break;case"harmonic":s=this.randomHarmonic(e);break;case"percussion":s=this.randomPercussion(e);break;case"note":s=this.randomNote(e);break;case"laser":s=this.randomLaser(e);break;case"pickup":s=this.randomPickup(e);break;case"explosion":s=this.randomExplosion(e);break;case"ambient":s=this.randomAmbient(e);break;default:s=this.randomAny(e)}await s.load();let n=i||`${t}_${Date.now()}.wav`;return s.downloadAsWAV(n),s}static async downloadVariations(t,e=3,i={}){let s=this.createVariations(t,e,i);for(let n=0;n<s.length;n++){await s[n].load();let r=`${t}_variation_${n+1}_${Date.now()}.wav`;setTimeout(()=>{s[n].downloadAsWAV(r)},n*500)}return s}};return _t(ee);})();

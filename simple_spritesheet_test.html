<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Spritesheet Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { margin: 5px 0; padding: 5px; background: #f0f0f0; border-radius: 3px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>Simple Spritesheet Test</h1>
    <div id="log"></div>

    <script type="module">
        const log = document.getElementById('log');
        
        function addLog(message, isSuccess = true) {
            const div = document.createElement('div');
            div.className = `log ${isSuccess ? 'success' : 'error'}`;
            div.textContent = message;
            log.appendChild(div);
            console.log(message);
        }

        // Import from dist files
        import { SpriteRegistry, SpritesheetAsset } from './dist/nity.module.min.js';

        addLog('✓ Imports successful');
        
        // Check initial state
        addLog(`Initial sprites count: ${SpriteRegistry.sprites.size}`);
        addLog(`Initial spritesheets count: ${SpriteRegistry.spritesheets.size}`);
        
        // Create a test image data URL (1x1 pixel)
        const testImageData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAFElEQVQIHWP8//8/AzYwOjmtCBZBAwBxrCMKCjYYMAAAAEF0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=';
        
        // Create spritesheet
        addLog('Creating spritesheet...');
        const sheet = new SpritesheetAsset('test', testImageData, {
            spriteWidth: 1,
            spriteHeight: 1,
            columns: 2,
            rows: 1
        });
        
        addLog('✓ Spritesheet created');
        
        // Check registry after creation
        addLog(`Sprites after creation: ${SpriteRegistry.sprites.size}`);
        addLog(`Spritesheets after creation: ${SpriteRegistry.spritesheets.size}`);
        
        // Check if spritesheet is registered
        const registeredSheet = SpriteRegistry.getSpritesheet('test');
        addLog(`Spritesheet registered: ${registeredSheet ? 'YES' : 'NO'}`, !!registeredSheet);
        
        // Check if individual sprites are registered
        const sprite0 = SpriteRegistry.getSprite('test:sprite_0');
        const sprite1 = SpriteRegistry.getSprite('test:sprite_1');
        
        addLog(`sprite_0 registered: ${sprite0 ? 'YES' : 'NO'}`, !!sprite0);
        addLog(`sprite_1 registered: ${sprite1 ? 'YES' : 'NO'}`, !!sprite1);
        
        // Show all registered sprite keys
        const allSpriteKeys = Array.from(SpriteRegistry.sprites.keys());
        addLog(`All sprite keys: [${allSpriteKeys.join(', ')}]`);
        
        // Check sprite wrapper properties
        if (sprite0) {
            addLog(`sprite_0 name: ${sprite0.name}`);
            addLog(`sprite_0 isLoaded: ${sprite0.isLoaded}`);
            addLog(`sprite_0 has image: ${sprite0.image ? 'YES' : 'NO'}`);
        }
        
        // Test after image loads
        setTimeout(() => {
            addLog('--- After image load ---');
            addLog(`sprite_0 isLoaded: ${sprite0 ? sprite0.isLoaded : 'null'}`);
            addLog(`sprite_0 has image: ${sprite0 && sprite0.image ? 'YES' : 'NO'}`);
        }, 200);
        
    </script>
</body>
</html>

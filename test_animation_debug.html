<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animation Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        canvas { border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Animation Debug Test</h1>
    <canvas id="game" width="400" height="300"></canvas>
    <div id="debug"></div>

    <script type="module">
        import { 
            Game, 
            Scene, 
            GameObject, 
            SpriteRendererComponent, 
            CameraComponent, 
            SpritesheetAsset,
            SpriteAnimationComponent,
            SpriteAnimationClip,
            SpriteRegistry
        } from './dist/nity.module.min.js';

        const canvas = document.getElementById('game');
        const game = new Game(canvas);
        const debug = document.getElementById('debug');

        function log(message) {
            const div = document.createElement('div');
            div.textContent = message;
            debug.appendChild(div);
            console.log(message);
        }

        const scene = new Scene({
            create(scene) {
                log('Creating scene...');
                
                // Create spritesheet
                const sheet = new SpritesheetAsset("test_sheet", 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAFElEQVQIHWP8//8/AzYwOjmtCBZBAwBxrCMKCjYYMAAAAEF0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAASUVORK5CYII=', {
                    spriteWidth: 1,
                    spriteHeight: 1,
                    columns: 2,
                    rows: 1
                });

                // Wait for spritesheet to load
                setTimeout(() => {
                    log('Checking sprite registration...');
                    
                    const sprite0 = SpriteRegistry.getSprite('test_sheet:sprite_0');
                    const sprite1 = SpriteRegistry.getSprite('test_sheet:sprite_1');
                    
                    log(`sprite_0 exists: ${sprite0 ? 'YES' : 'NO'}`);
                    log(`sprite_1 exists: ${sprite1 ? 'YES' : 'NO'}`);
                    
                    if (sprite0) {
                        log(`sprite_0 isLoaded: ${sprite0.isLoaded}`);
                        log(`sprite_0 has image: ${sprite0.image ? 'YES' : 'NO'}`);
                    }
                    
                    // Create animated GameObject
                    const player = new GameObject(100, 100);
                    
                    // Add sprite renderer
                    const renderer = new SpriteRendererComponent("test_sheet:sprite_0");
                    player.addComponent(renderer);
                    
                    // Add animation component
                    const anim = new SpriteAnimationComponent("test_anim");
                    anim.addClip(new SpriteAnimationClip("test_anim", [
                        "test_sheet:sprite_0", 
                        "test_sheet:sprite_1"
                    ], 2, true));
                    player.addComponent(anim);
                    
                    log('Added animation component');
                    
                    // Check if animation component can get renderer
                    const rendererComponent = player.getComponent(SpriteRendererComponent);
                    log(`Renderer component found: ${rendererComponent ? 'YES' : 'NO'}`);
                    
                    scene.add(player);
                    log('Added player to scene');
                    
                    // Camera
                    const camera = new GameObject(0, 0);
                    camera.addComponent(new CameraComponent(game.canvas, 4));
                    scene.add(camera);
                    game.mainCamera = camera;
                    
                }, 100);
            }
        });

        game.launch(scene);
    </script>
</body>
</html>

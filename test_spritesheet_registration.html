<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Spritesheet Registration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>Spritesheet Registration Test</h1>
    <div id="output"></div>

    <script type="module">
        import { SpriteRegistry } from './src/asset/SpriteRegistry.js';
        import { SpritesheetAsset } from './src/asset/SpritesheetAsset.js';

        const output = document.getElementById('output');
        
        function log(message, isSuccess = true) {
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.textContent = message;
            output.appendChild(div);
            console.log(message);
        }

        function testRegistration() {
            try {
                // Create a spritesheet
                const sheet = new SpritesheetAsset('test_sheet', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==', {
                    spriteWidth: 32,
                    spriteHeight: 32,
                    columns: 2,
                    rows: 2
                });

                // Test immediate registration (before image loads)
                log('✓ Spritesheet asset created');
                
                // Check if spritesheet is registered
                const registeredSheet = SpriteRegistry.getSpritesheet('test_sheet');
                log(`✓ Spritesheet registered: ${registeredSheet ? 'YES' : 'NO'}`, !!registeredSheet);

                // Check individual sprite registration
                const sprite0 = SpriteRegistry.getSprite('test_sheet:sprite_0');
                const sprite1 = SpriteRegistry.getSprite('test_sheet:sprite_1');
                const sprite2 = SpriteRegistry.getSprite('test_sheet:sprite_2');
                const sprite3 = SpriteRegistry.getSprite('test_sheet:sprite_3');

                log(`✓ sprite_0 registered: ${sprite0 ? 'YES' : 'NO'}`, !!sprite0);
                log(`✓ sprite_1 registered: ${sprite1 ? 'YES' : 'NO'}`, !!sprite1);
                log(`✓ sprite_2 registered: ${sprite2 ? 'YES' : 'NO'}`, !!sprite2);
                log(`✓ sprite_3 registered: ${sprite3 ? 'YES' : 'NO'}`, !!sprite3);

                // Check registry contents
                log(`✓ Total sprites in registry: ${SpriteRegistry.sprites.size}`);
                log(`✓ Total spritesheets in registry: ${SpriteRegistry.spritesheets.size}`);

                // List all registered sprites
                const allSprites = Array.from(SpriteRegistry.sprites.keys());
                log(`✓ All registered sprites: ${allSprites.join(', ')}`);

                // Test after image loads
                setTimeout(() => {
                    log(`✓ After image load - sprite_0 isLoaded: ${sprite0 ? sprite0.isLoaded : 'null'}`);
                    log(`✓ After image load - sprite_0 has image: ${sprite0 && sprite0.image ? 'YES' : 'NO'}`);
                }, 100);

            } catch (error) {
                log(`❌ Error: ${error.message}`, false);
                console.error(error);
            }
        }

        // Run test
        testRegistration();
    </script>
</body>
</html>
